<!DOCTYPE html>
<html  class="light"><head><base href="https://arctic-hen7.github.io/perseus/" />
<meta  charset="UTF-8"/><meta  name="viewport" content="width=device-width, initial-scale=1.0"/><link  rel="stylesheet" href=".perseus/static/tailwind.css"/><link  rel="stylesheet" href=".perseus/static/styles/style.css"/>
            <script type="module">window.__PERSEUS_RENDER_CFG = '{"docs/0.3.4/reference/testing/checkpoints":"docs","docs/reference/testing/fantoccini-basics":"docs","docs/0.3.4/reference/plugins/security":"docs","docs/next/reference/exporting":"docs","docs/0.4.x/reference/state-generation":"docs","docs/reference/deploying/intro":"docs","docs/0.3.4/reference/strategies/request-state":"docs","docs/0.4.x/reference/hydration":"docs","docs/0.3.0-0.3.3/views":"docs","docs/0.4.x/reference/compilation-times":"docs","docs/reference/error-pages":"docs","docs/reference/strategies/amalgamation":"docs","docs/0.3.0-0.3.3/testing/fantoccini-basics":"docs","docs/0.3.4/reference/templates/metadata-modification":"docs","docs/0.3.0-0.3.3/advanced/initial-loads":"docs","docs/0.3.4/reference/state/hsr":"docs","docs/0.3.4/advanced/subsequent-loads":"docs","docs/next/reference/architecture":"docs","docs/reference/plugins/control":"docs","docs/0.3.0-0.3.3/deploying/serverless":"docs","docs/0.3.4/reference/index-view":"docs","docs/reference/templates/setting-headers":"docs","docs/advanced/routing":"docs","docs/0.1.x/strategies/request_state":"docs","docs/reference/updating":"docs","docs/reference/templates/intro":"docs","docs/reference/state/rx":"docs","docs/reference/strategies/build-state":"docs","docs/0.4.x/reference/deploying":"docs","docs/reference/plugins/publishing":"docs","docs/0.1.x/strategies/revalidation":"docs","docs/0.2.x/testing/fantoccini-basics":"docs","docs/0.3.0-0.3.3/i18n/using":"docs","docs/0.3.0-0.3.3/testing/checkpoints":"docs","docs/0.3.4/advanced/arch":"docs","docs/0.3.4/reference/stores":"docs","docs/0.3.0-0.3.3/testing/manual":"docs","docs/next/getting-started/intro":"docs","docs/0.2.x/testing/intro":"docs","docs/0.3.4/intro":"docs","docs/0.3.4/tutorials/second-app":"docs","docs/reference/plugins/security":"docs","docs/reference/strategies/revalidation":"docs","docs/0.3.0-0.3.3/debugging":"docs","docs/0.1.x/intro":"docs","docs/advanced/initial-loads":"docs","docs/next/reference/migrating":"docs","docs/0.3.4/reference/deploying/serverful":"docs","docs/0.4.x/reference/plugins":"docs","docs/next/core-principles":"docs","docs/0.3.4/reference/engines":"docs","docs/0.3.0-0.3.3/templates/intro":"docs","docs/0.3.0-0.3.3/styling":"docs","docs/reference/deploying/size":"docs","docs/0.1.x/tutorials/first_app/template":"docs","docs/0.3.0-0.3.3/snooping":"docs","docs/0.2.x/i18n/defining":"docs","docs/0.1.x/arch":"docs","docs/reference/strategies/request-state":"docs","docs/0.1.x/setup":"docs","docs/what-is-perseus":"docs","docs/next/reference/state-generation":"docs","docs/0.3.4/reference/i18n/intro":"docs","docs/0.4.x/reference/exporting":"docs","docs/0.2.x/testing/manual":"docs","docs/next/reference/faq":"docs","docs/0.2.x/advanced/arch":"docs","docs/reference/strategies/build-paths":"docs","docs/0.2.x/testing/checkpoints":"docs","docs/reference/static-content":"docs","docs/0.2.x/second-app":"docs","docs/0.3.4/reference/updating":"docs","docs/0.4.x/core-principles":"docs","docs/next/reference/live-reloading-and-hsr":"docs","docs/0.3.4/core-principles":"docs","docs/0.2.x/hello-world":"docs","docs/0.1.x/strategies/intro":"docs","docs/0.3.4/advanced/initial-loads":"docs","docs/0.3.4/reference/i18n/defining":"docs","docs/0.3.4/reference/debugging":"docs","docs/0.1.x/strategies/build_paths":"docs","docs/0.2.x/deploying/exporting":"docs","docs/0.3.0-0.3.3/static-content":"docs","docs/reference/views":"docs","docs/next/getting-started/first-app":"docs","docs/next/tutorials/second-app":"docs","docs/0.1.x/building":"docs","docs/0.3.4/reference/static-content":"docs","docs/0.3.0-0.3.3/what-is-perseus":"docs","docs/reference/live-reloading":"docs","docs/0.3.0-0.3.3/advanced/routing":"docs","docs/reference/i18n/translations-managers":"docs","docs/0.3.4/advanced/intro":"docs","docs/0.3.0-0.3.3/testing/intro":"docs","docs/0.3.0-0.3.3/strategies/amalgamation":"docs","docs/0.2.x/strategies/revalidation":"docs","docs/0.4.x/reference/initial_subsequent_loads":"docs","docs/0.3.0-0.3.3/cli":"docs","docs/0.4.x/getting-started/installation":"docs","docs/0.3.4/reference/deploying/intro":"docs","docs/0.3.4/reference/plugins/using":"docs","docs/0.1.x/routing":"docs","docs/0.3.4/reference/i18n/using":"docs","docs/0.3.0-0.3.3/pitfalls-and-bugs":"docs","docs/next/reference/deploying":"docs","docs/0.3.0-0.3.3/advanced/intro":"docs","docs/reference/debugging":"docs","docs/0.2.x/debugging":"docs","docs/0.1.x/strategies/build_state":"docs","docs/0.3.0-0.3.3/ejecting":"docs","docs/0.3.0-0.3.3/advanced/arch":"docs","docs/reference/pitfalls-and-bugs":"docs","docs/0.2.x/deploying/intro":"docs","docs/reference/state/freezing":"docs","docs/0.3.4/reference/ejecting":"docs","docs/0.2.x/templates/intro":"docs","docs/0.4.x/what-is-perseus":"docs","docs/0.3.4/reference/state/idb-freezing":"docs","docs/0.3.4/reference/strategies/amalgamation":"docs","docs/0.3.4/reference/deploying/size":"docs","docs/tutorials/second-app":"docs","docs/0.3.4/reference/strategies/build-paths":"docs","docs/reference/plugins/writing":"docs","docs/0.3.0-0.3.3/plugins/publishing":"docs","docs/0.2.x/advanced/routing":"docs","docs/0.2.x/i18n/other-engines":"docs","docs/next/reference/hydration":"docs","docs/0.4.x/reference/architecture":"docs","docs/0.3.0-0.3.3/intro":"docs","docs/0.1.x/templates":"docs","docs/0.3.0-0.3.3/strategies/revalidation":"docs","docs/0.3.0-0.3.3/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/error-pages":"docs","docs/0.3.4/reference/views":"docs","docs/0.2.x/define-app":"docs","docs/0.3.4/what-is-perseus":"docs","docs/0.3.4/reference/plugins/publishing":"docs","docs/0.3.0-0.3.3/strategies/incremental":"docs","docs/0.3.4/reference/live-reloading":"docs","index":"index","docs/0.3.0-0.3.3/second-app":"docs","docs/0.2.x/advanced/subsequent-loads":"docs","comparisons":"comparisons","docs/0.3.0-0.3.3/exporting":"docs","docs/0.3.4/reference/deploying/docker":"docs","docs/0.2.x/ejecting":"docs","docs/reference/state/hsr":"docs","docs/0.3.4/reference/hydration":"docs","docs/0.3.0-0.3.3/deploying/size":"docs","docs/0.3.4/reference/templates/router-state":"docs","docs/0.3.0-0.3.3/plugins/security":"docs","docs/reference/testing/manual":"docs","docs/reference/testing/checkpoints":"docs","docs/0.3.0-0.3.3/plugins/functional":"docs","docs/0.3.0-0.3.3/hello-world":"docs","docs/reference/templates/router-state":"docs","docs/0.3.0-0.3.3/i18n/defining":"docs","docs/0.3.0-0.3.3/i18n/translations-managers":"docs","docs/reference/state/global":"docs","docs/0.1.x/serving":"docs","docs/0.3.4/reference/define-app":"docs","docs/0.3.4/reference/snooping":"docs","docs/0.3.4/reference/strategies/build-state":"docs","docs/0.2.x/what-is-perseus":"docs","docs/reference/engines":"docs","docs/core-principles":"docs","docs/intro":"docs","docs/0.2.x/cli":"docs","docs/reference/templates/metadata-modification":"docs","docs/0.3.4/reference/templates/setting-headers":"docs","docs/0.3.0-0.3.3/plugins/using":"docs","docs/0.4.x/tutorials/second-app":"docs","docs/0.2.x/templates/metadata-modification":"docs","docs/0.3.4/reference/cli":"docs","docs/reference/perseus-app":"docs","docs/reference/snooping":"docs","docs/0.2.x/i18n/using":"docs","docs/next/what-is-perseus":"docs","docs/0.3.4/reference/templates/intro":"docs","docs/0.1.x/tutorials/first_app/intro":"docs","docs/0.3.4/reference/pitfalls-and-bugs":"docs","docs/next/reference/initial_subsequent_loads":"docs","docs/tutorials/auth":"docs","docs/0.3.4/reference/i18n/translations-managers":"docs","docs/0.3.0-0.3.3/updating":"docs","docs/next/intro":"docs","docs/0.2.x/templates/setting-headers":"docs","docs/0.3.4/reference/strategies/intro":"docs","docs/advanced/subsequent-loads":"docs","docs/reference/strategies/intro":"docs","docs/reference/i18n/using":"docs","docs/0.3.4/reference/strategies/incremental":"docs","docs/reference/plugins/functional":"docs","docs/0.2.x/strategies/intro":"docs","docs/0.3.4/reference/state/global":"docs","docs/0.2.x/i18n/translations-managers":"docs","docs/tutorials/hello-world":"docs","docs/reference/stores":"docs","docs/reference/styling":"docs","docs/reference/plugins/tinker":"docs","docs/0.1.x/strategies/incremental":"docs","docs/0.3.4/tutorials/auth":"docs","docs/0.2.x/error-pages":"docs","docs/0.2.x/strategies/amalgamation":"docs","docs/0.3.0-0.3.3/deploying/serverful":"docs","docs/0.2.x/config-managers":"docs","docs/reference/define-app":"docs","docs/0.2.x/styling":"docs","docs/0.4.x/intro":"docs","docs/reference/server-communication":"docs","docs":"docs","docs/reference/deploying/serverless":"docs","docs/0.3.4/reference/plugins/functional":"docs","docs/0.3.4/reference/exporting":"docs","docs/0.3.4/reference/plugins/intro":"docs","docs/reference/i18n/intro":"docs","docs/0.3.4/reference/testing/manual":"docs","docs/next/reference/compilation-times":"docs","docs/0.3.4/reference/perseus-app":"docs","docs/reference/deploying/docker":"docs","docs/0.3.4/reference/plugins/control":"docs","docs/0.3.0-0.3.3/plugins/intro":"docs","docs/0.3.4/reference/deploying/serverless":"docs","docs/0.2.x/intro":"docs","docs/0.3.0-0.3.3/deploying/docker":"docs","docs/0.2.x/strategies/build-paths":"docs","docs/0.3.4/reference/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/strategies/intro":"docs","docs/reference/strategies/incremental":"docs","docs/0.4.x/features":"docs","docs/0.3.0-0.3.3/advanced/subsequent-loads":"docs","docs/advanced/intro":"docs","docs/reference/state/idb-freezing":"docs","docs/0.1.x/cli":"docs","docs/0.4.x/reference/live-reloading-and-hsr":"docs","docs/0.2.x/advanced/intro":"docs","docs/0.2.x/updating":"docs","docs/0.3.0-0.3.3/server-communication":"docs","docs/0.4.x/reference/i18n":"docs","docs/0.2.x/strategies/build-state":"docs","docs/0.3.0-0.3.3/plugins/writing":"docs","docs/0.3.4/reference/plugins/writing":"docs","docs/0.1.x/integrations/actix-web":"docs","docs/0.3.4/tutorials/hello-world":"docs","docs/0.3.4/advanced/route-announcer":"docs","docs/0.3.0-0.3.3/advanced/define_app":"docs","docs/0.3.4/reference/i18n/other-engines":"docs","docs/0.3.0-0.3.3/i18n/intro":"docs","docs/0.4.x/reference/migrating":"docs","docs/0.4.x/reference/router":"docs","docs/0.3.4/reference/error-pages":"docs","docs/advanced/route-announcer":"docs","docs/0.3.4/advanced/routing":"docs","docs/next/features":"docs","docs/0.2.x/static-content":"docs","docs/0.4.x/reference/faq":"docs","docs/0.2.x/views":"docs","docs/0.2.x/strategies/incremental":"docs","docs/0.3.0-0.3.3/stores":"docs","docs/next/reference/i18n":"docs","docs/0.1.x/config_managers":"docs","docs/0.4.x/getting-started/intro":"docs","docs/reference/index-view":"docs","docs/0.3.0-0.3.3/templates/metadata-modification":"docs","docs/0.3.4/reference/testing/intro":"docs","docs/next/getting-started/installation":"docs","docs/0.3.4/reference/testing/fantoccini-basics":"docs","docs/reference/ejecting":"docs","docs/next/reference/router":"docs","docs/0.1.x/tutorials/first_app/setup":"docs","docs/0.3.0-0.3.3/deploying/intro":"docs","docs/next/reference/plugins":"docs","docs/0.3.0-0.3.3/templates/setting-headers":"docs","docs/advanced/arch":"docs","docs/reference/cli":"docs","docs/0.3.4/reference/server-communication":"docs","docs/0.3.4/reference/state/rx":"docs","docs/0.3.0-0.3.3/strategies/request-state":"docs","docs/reference/plugins/intro":"docs","plugins":"plugins","docs/0.3.4/reference/styling":"docs","docs/0.2.x/i18n/intro":"docs","docs/reference/plugins/using":"docs","docs/reference/testing/intro":"docs","docs/0.3.4/reference/plugins/tinker":"docs","docs/reference/i18n/other-engines":"docs","docs/0.4.x/getting-started/first-app":"docs","docs/reference/exporting":"docs","docs/0.3.0-0.3.3/strategies/build-state":"docs","docs/reference/deploying/serverful":"docs","docs/0.1.x/error_pages":"docs","docs/0.3.4/reference/strategies/revalidation":"docs","docs/0.3.0-0.3.3/plugins/tinker":"docs","docs/0.2.x/advanced/initial-loads":"docs","docs/reference/hydration":"docs","docs/reference/i18n/defining":"docs","docs/0.3.0-0.3.3/strategies/build-paths":"docs","docs/0.3.4/reference/state/freezing":"docs","docs/0.2.x/strategies/request-state":"docs","docs/0.3.0-0.3.3/define-app":"docs","docs/reference/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/plugins/control":"docs","docs/0.3.0-0.3.3/hydration":"docs","docs/0.1.x/tutorials/first_app/app":"docs","docs/0.3.0-0.3.3/i18n/other-engines":"docs"}';

        import init from "https://arctic-hen7.github.io/perseus/.perseus/bundle.js";
        async function main() {
            await init("https://arctic-hen7.github.io/perseus/.perseus/bundle.wasm");
        }
        main();
        

window.__PERSEUS_GLOBAL_STATE = `None`;</script>
            <!--PERSEUS_INTERPOLATED_HEAD_BEGINS-->
            
<title>Your Second App | Perseus Docs</title><link rel="stylesheet" href=".perseus/static/styles/markdown.css"/><link rel="stylesheet" href=".perseus/static/styles/docs_links_markdown.css"/><link rel="stylesheet" href=".perseus/static/prism.css"/>
            <script>
window.__PERSEUS_INITIAL_STATE = `{"title":"Your Second App","content":"<h1>Your Second App</h1>\\n<p>Now it's time to build a more realistic app with Perseus, one that takes advantage of the state platform and uses a structure more similar to one you'd see in a real Perseus app. All the code for this tutorial is available <a href=\\"https://github.com/arctic-hen7/perseus/tree/main/examples/core/basic\\">here</a>.</p>\\n<p>Note that this tutorial assumes you've already installed Rust and the Perseus CLI as per <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/installation\\">these instructions</a>.</p>\\n<h2>Setup</h2>\\n<p>We can create a new Perseus project by going to some directory and running <code>perseus new my-app</code>, which will create a folder called <code>my-app/</code> and set it up for Perseus. Then, you can pop in there and make sure <code>Cargo.toml</code> looks like the following:</p>\\n<pre><code class=\\"language-toml\\">[package]\\nname = &quot;my-app&quot;\\nversion = &quot;0.1.0&quot;\\nedition = &quot;2021&quot;\\n\\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\\n\\n[dependencies]\\nperseus = { version = &quot;=0.4.0-beta.7&quot;, features = [ &quot;hydrate&quot; ] }\\nsycamore = &quot;=0.8.0-beta.7&quot;\\nserde = { version = &quot;1&quot;, features = [&quot;derive&quot;] }\\nserde_json = &quot;1&quot;\\n\\n[target.'cfg(not(target_arch = &quot;wasm32&quot;))'.dependencies]\\ntokio = { version = &quot;1&quot;, features = [ &quot;macros&quot;, &quot;rt&quot;, &quot;rt-multi-thread&quot; ] }\\nperseus-warp = { version = &quot;=0.4.0-beta.7&quot;, features = [ &quot;dflt-server&quot; ] }\\n\\n[target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies]\\n\\n</code></pre>\\n<p>This is almost identical to the <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/first-app\\">first app</a> we built, so we'll skip over further explanation here. Recall though that this structure of declaring engine-side and browser-side dependencies separately is a fairly standard pattern in Perseus.</p>\\n<p>Next, create some files and folders so that your project tree looks like this:</p>\\n<pre><code>├── Cargo.toml\\n└── src\\n    ├── error_pages.rs\\n    ├── lib.rs\\n    └── templates\\n        ├── about.rs\\n        ├── index.rs\\n        └── mod.rs\\n</code></pre>\\n<p>Great, now you've got your basic directory setup for a Perseus project! For a quick foreshadowing, we'll be putting our app declaration in <code>src/lib.rs</code>, our error pages (for 404 etc.) in <code>src/error_pages.rs</code>, adn each of the files in <code>templates/</code> will correspond to a template (which could generate as many pages as it wants, see <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles\\">here</a> for an explanation of this).</p>\\n<p>Finally, add the following to the top of <code>src/lib.rs</code> so that Cargo knows about this structure:</p>\\n<pre><code class=\\"language-rust\\">mod error_pages;\\nmod templates;\\n</code></pre>\\n<p>And then make <code>src/templates/mod.rs</code> look like the following to declare the files in there to Cargo:</p>\\n<pre><code class=\\"language-rust\\">pub mod about;\\npub mod index;\\n\\n</code></pre>\\n<p>The reason these are <code>pub mod</code>s is so that we can access them from <code>lib.rs</code> easily.</p>\\n<h2>Index template</h2>\\n<p>Let's jump right into the code of this app! We'll start with the index template, which will render the landing page of our site. The code for this is accordingly in <code>src/templates/index.rs</code>.</p>\\n<p>In <code>src/templates/index.rs</code>, dump the following code (replacing the auto-generated code):</p>\\n<pre><code class=\\"language-rust\\">use perseus::{Html, RenderFnResultWithCause, SsrNode, Template};\\nuse sycamore::prelude::{view, Scope, View};\\n\\n#[perseus::make_rx(IndexPageStateRx)]\\npub struct IndexPageState {\\n    pub greeting: String,\\n}\\n\\n#[perseus::template_rx]\\npub fn index_page&lt;'a, G: Html&gt;(cx: Scope&lt;'a&gt;, state: IndexPageStateRx&lt;'a&gt;) -&gt; View&lt;G&gt; {\\n    view! { cx,\\n        p { (state.greeting.get()) }\\n        a(href = &quot;about&quot;, id = &quot;about-link&quot;) { &quot;About!&quot; }\\n    }\\n}\\n\\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\\n    Template::new(&quot;index&quot;)\\n        .build_state_fn(get_build_state)\\n        .template(index_page)\\n        .head(head)\\n}\\n\\n#[perseus::head]\\npub fn head(cx: Scope, _props: IndexPageState) -&gt; View&lt;SsrNode&gt; {\\n    view! { cx,\\n        title { &quot;Index Page | Perseus Example – Basic&quot; }\\n    }\\n}\\n\\n#[perseus::build_state]\\npub async fn get_build_state(\\n    _path: String,\\n    _locale: String,\\n) -&gt; RenderFnResultWithCause&lt;IndexPageState&gt; {\\n    Ok(IndexPageState {\\n        greeting: &quot;Hello World!&quot;.to_string(),\\n    })\\n}\\n\\n</code></pre>\\n<p>This is much more complex than our first app, so let's dive into explanation. Note that the imports at the top of this file will be explained as we go.</p>\\n<p>The first thing then is <code>IndexPageState</code>, which is our first usage of Perseus' state platform. As explained <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles\\">here</a>, a page in Perseus is produced from a template and some state. In this template, we'll only be rendering one template, but it will use some state to demonstrate how we can execute arbitrary code when we build our app to create pages. In this case, our state is dead simple, containing only one property, <code>greeting</code>, which is a <code>String</code>.</p>\\n<p>Importantly, we've annotated that with <code>#[perseus::make_rx(IndexPageStateRx)]</code>, which will create a version of this <code>struct</code> that uses Sycamore's <code>Signal</code>s: a reactive version. If you're unfamiliar with Sycamore's reactivity system, you should read <a href=\\"https://sycamore-rs.netlify.app/docs/basics/reactivity\\">this</a> quickly before continuing.</p>\\n<p>Next, we create a function called <code>index_page</code>, which we annotate with <code>#[perseus::template_rx]</code>. That macro is used for declaring templates, and you can think of it like black box that makes things work.</p>\\n<details>\\n<summary>Details??</summary>\\n<p>What that macro actually does depends on the complexity of your template, but the core purpose is to make sure it gets the right state. Internally, Perseus passes around all state as serialized <code>String</code>s, since it needs to be sent over the network from the server. This macro performs deserialization for you, and registers the state with the app-wide state management system if it's the first load of it. If not, it will restore previous state, meaning, for example, that user inputs can retain their content even if the user goes to three other pages in your app before returning, with no extra code from you. The workings of these macros aren't too complex, but they are extremely unergonomic.</p>\\n<p>If you really viscerally hate macros though, then you <em>could</em> implement the under-the-hood stuff manually based on <a href=\\"\\">this file</a>, but we seriously wouldn't recommend it. Also, that code could change at any time, which means any update could be a breaking change for you.</p>\\n<p><em>Note: these macros are progressively becoming less and less important to Perseus. Eventually, we hope to reduce them to the absolute minimum necessary for functionality.</em></p>\\n</details>\\n<p>This function takes two arguments: a Sycamore reactive scope and the reactive version of the state, which both share the same lifetime <code>'a</code>. Don't worry though, we won't have to worry about these lifetimes most of the time, Sycamore is very well-designed to make them stay out of our way! They're just there to make things much more ergonomic and speedy. (In older version,s you had to <code>.clone()</code> <em>everything</em>.)</p>\\n<p>Finally, we produce a Sycamore <a href=\\"https://docs.rs/sycamore/0.4.0-beta/sycamore/struct.View.html\\"><code>View</code></a>, which will render content to the user's browser. Notably, this function is generic over a type parameter <code>G: Html</code>, which we use to make sure this code can be run on both the engine-side and the browser-side.</p>\\n<details>\\n<summary>Wait up, why are my templates being rendered on the engine-side?</summary>\\n<p>To improve performance <em>dramatically</em>, Perseus renders all pages on the engine-side before your app ever gets to users, creating fully-built HTML that can be sent down at a moment's notice, meaning users see pages quickly, and then they become interactive a moment later. Generally, this is agreed to be much better than users having to wait potentially several seconds to see anything on your site at all. </p>\\n<p>As a result of this, the code in any template function must be able to run on both the browser-side and the server-side. But, you can always use <code>#[cfg(target_arch = &quot;wasm32&quot;)]</code> to gate browser-only code, or <code>#[cfg(not(target_arch = &quot;wasm32&quot;))]</code> to gate engine-only code.</p>\\n</details>\\n<p>Inside this function, we use Sycamore's <a href=\\"https://docs.rs/sycamore/0.4.0-beta/sycamore/macro.view.html\\"><code>view!</code></a> macro to a create a view for the user, which will be displayed in their browser. We provide the reactive scope <code>cx</code>, and then we have just two items we're rendering. The second is a simple link to <code>about</code>, which is the same as <code>/about</code>, but without the absolutism that the route has to be at the top-level (instead, it will be relative to the rest of the site, which lets you serve your entire app inside another website trivially --- it's exactly what's done on this website!).</p>\\n<p>The first element is a paragraph that contains some dynamic content. Specifically, the value of that <code>greeting</code> property in our state. Notably, we're calling <code>.get()</code> on that, because, remember, we're using the reactive version, so it's not a <code>String</code> anymore, it's a <code>&amp;'a Signal&lt;String&gt;</code>! Again, you don't need to worry about the lifetimes, Sycamore makes all that seamless for you.</p>\\n<p>Notably, we could actually change this value at runtime if we wanted by calling <code>.set()</code>, but we won't do that in this example.</p>\\n<p>The next function we define is <code>get_template()</code>, which is fairly straightforward. It just declares a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html\\"><code>Template</code></a> with the necessary properties. Specifically, we define the function that actually renders the template as <code>index_page</code>, and the other two we'll get to now.</p>\\n<p>The first of those is the <code>head()</code> function, which is annotated as <code>#[perseus::head]</code> (which has similar responsibilities to <code>#[perseus::template_rx]</code>). In HTML, the language for creating views on the web, there are two main components to every page: the <code>&lt;body&gt;</code> and the <code>&lt;head&gt;</code>, the latter of which defines certain metadata, like the title, and any stylesheets you need, for example. If <code>index_page()</code> creates the body, then <code>head()</code> creates the head in this example. Notably, because the head is rendered only ahead of time, it can't be reactive. For that reason, it's passed the unreactive version of the state, and, rather than being generic over <code>Html</code>, it uses <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.SsrNode.html\\"><code>SsrNode</code></a>, which is specialized for the engine-side.</p>\\n<p>Because this function will only ever run on the engine-side, <code>#[perseus::head]</code> implies a target-gate to the engine (i.e. <code>#[cfg(not(target_arch = &quot;wasm32&quot;))]</code> is implicit). This means you can use engine-side dependencies here without any extra gating.</p>\\n<p>Finally, <code>get_build_state()</code> is responsible for generating an instance of <code>IndexPageState</code> that the template will be rendered with ahead of time on the engine-side. In this example, this logic is very simple, just generating a static <code>greeting</code>, but, in more complex apps, this might fetch information from a database, or it could run more complex computations.</p>\\n<p>For example, this very website uses build-time state generation to fetch the content for each of these docs pages from Markdown, rendering then to HTML, making the experience of both writing and viewing these docs as smooth as possible!</p>\\n<p>Importantly, that function takes two parameters: the path of the page (only relevant if you're using <em>build paths</em> too) and the locale (only relevant if you're using internationalization). Crucially, we return a <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.RenderFnResultWithCause.html\\"><code>RenderFnResultWithCause</code></a>, which is basically a glorified <code>Result</code> that lets you return any error type you want. But, we need to do one more thing if we get an error in state generation: we need to know who's responsible. You're probably familiar with the 404 HTTP status code, meaning the page wasn't found, but there are actually dozens of these, all with different meanings (like 418, which indicates the server is a teapot incapable of brewing coffee). The 4xx codes are for when the client caused the problems, and the 5xx codes are for when the server caused the problem. For the Perseus server to know which of these to send, it needs to know who was responsible, which <code>RenderFnResultWithCause</code> lets you declare. For an example of how to return errors from here like this, see <a href=\\"\\">here</a>.</p>\\n<details>\\n<summary>But we're generating on the engine-side...</summary>\\n<p>It may seem like the client could never be responsible, since we're generating state at build time. That's true, unless you're using <em>incremental generation</em>, which is another state generation strategy that means functions like <code>get_build_state()</code> could be executed on the engine-side while the server is running in production, and the <code>path</code> parameter can be arbitrary. In these cases, the client can most certainly cause an error.</p>\\n<p>If none of that makes sense, don't worry, you can learn more about it <a href=\\"\\">here</a>.</p>\\n</details>\\n<h2>About template</h2>\\n<p>With that done, we can build the second template of this app, which is much simpler! Add the following to <code>src/templates/about.rs</code>:</p>\\n<pre><code class=\\"language-rust\\">use perseus::Template;\\nuse sycamore::prelude::{view, Html, Scope, SsrNode, View};\\n\\n#[perseus::template_rx]\\npub fn about_page&lt;G: Html&gt;(cx: Scope) -&gt; View&lt;G&gt; {\\n    view! { cx,\\n        p { &quot;About.&quot; }\\n    }\\n}\\n\\n#[perseus::head]\\npub fn head(cx: Scope) -&gt; View&lt;SsrNode&gt; {\\n    view! { cx,\\n        title { &quot;About Page | Perseus Example – Basic&quot; }\\n    }\\n}\\n\\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\\n    Template::new(&quot;about&quot;).template(about_page).head(head)\\n}\\n\\n</code></pre>\\n<p>This is basically a simpler version of the index template, with no state, and this template only defines a simple view and some metadata in the head.</p>\\n<p>Importantly, this illustrates that templates that don't take state don't have to have a second argument for their nonexistent state, the <code>#[perseus::template_rx]</code> macro is smart enough to handle that (and even a third argument for global state).</p>\\n<h2>Error pages</h2>\\n<p>Before we tie everything together, we've got to handle errors in this app! If the user goes to a page that doesn't exist right now, they'll be greeted with a stock error page designed for development debugging and fast iteration. In production, we won't even be allowed to build our app unless we set up some error handling.</p>\\n<p>Add the following to <code>src/error_pages.rs</code>:</p>\\n<pre><code class=\\"language-rust\\">use perseus::{ErrorPages, Html};\\nuse sycamore::view;\\n\\npub fn get_error_pages&lt;G: Html&gt;() -&gt; ErrorPages&lt;G&gt; {\\n    let mut error_pages = ErrorPages::new(\\n        |cx, url, status, err, _| {\\n            view! { cx,\\n                p { (format!(&quot;An error with HTTP code {} occurred at '{}': '{}'.&quot;, status, url, err)) }\\n            }\\n        },\\n        |cx, _, _, _, _| {\\n            view! { cx,\\n                title { &quot;Error&quot; }\\n            }\\n        },\\n    );\\n    error_pages.add_page(\\n        404,\\n        |cx, _, _, _, _| {\\n            view! { cx,\\n                p { &quot;Page not found.&quot; }\\n            }\\n        },\\n        |cx, _, _, _, _| {\\n            view! { cx,\\n                title { &quot;Not Found&quot; }\\n            }\\n        },\\n    );\\n\\n    error_pages\\n}\\n\\n</code></pre>\\n<p>This is a very simplistic error page setup, but it illustrates pretty well what error pages actually are in Perseus. Essentially, you define a new <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.ErrorPages.html\\"><code>ErrorPages</code></a> instance that's again generic over <code>Html</code> so it can work on the engine-side and the browser-side. In that <code>::new()</code> function, you need to provide a fallback page, because you're unlikely to provide a different error page for every possible HTTP status code. If one occurs that you haven't explicitly handled for, this fallback page will be used. Then, we use <code>.add_page()</code> to add another page for the 404 HTTP status code (page not found).</p>\\n<p>Notably, an error page is defined with a closure that takes four arguments: a reactive scope, the URL the user was on when the error occurred (which they'll stay on while the error page is displayed), the HTTP status code, teh actual <code>String</code> error message, and a translator (but we aren't using i18n, so we don't need this).</p>\\n<h2>Tying it all together</h2>\\n<p>Now, we can bring everything together in <code>src/main.rs</code>:</p>\\n<pre><code class=\\"language-rust\\">mod error_pages;\\nmod templates;\\n\\nuse perseus::{Html, PerseusApp};\\n\\n#[perseus::main(perseus_integration::dflt_server)]\\npub fn main&lt;G: Html&gt;() -&gt; PerseusApp&lt;G&gt; {\\n    PerseusApp::new()\\n        .template(crate::templates::index::get_template)\\n        .template(crate::templates::about::get_template)\\n        .error_pages(crate::error_pages::get_error_pages)\\n}\\n\\n</code></pre>\\n<p><strong>Important:</strong> replace <code>perseus_integration</code> here with <code>perseus_warp</code>! We use <code>perseus_integration</code> as an internal glue crate, and all code in these docs is sourced directly from the examples.</p>\\n<p>This is quite similar to the first app we built, though with a few more complexities. As in that app, we declare a <code>main()</code> function annotated with <code>#[perseus::main(...)]</code> to declare the entrypoint of our app. In there, we define the function that will spin up our server, here just using the <code>dflt_server</code> of our chosen integration. In the <code>Cargo.toml</code> above, we used <code>perseus_warp</code>, but you could trivially use any integration you like (or whatever works with your existing servers, which Perseus can extend).</p>\\n<p>Then, on our <a href=\\"https://docs.rs/perseus/0.4.0-beta/perseus/struct.PerseusApp.html\\"><code>PerseusApp</code></a>, we define the two templates, and our error pages. Simple as that!</p>\\n<h2>Running it</h2>\\n<pre><code class=\\"language-shell\\">perseus serve -w\\n</code></pre>\\n<p>This will compile your whole app (which might take a while for the first time), and then serve it at <a href=\\"http://localhost:8080\\">http://localhost:8080</a>! If you take a look there, you should be greeted with <em>Hello World!</em> and a link to the about page, which should take you there without causing the browser to load a new page. This demonstrates how Perseus internally switches pages out with minimal requests to the server, using less bandwidth and enabling faster page transitions.</p>\\n<p>Now, try changing that <em>Hello World!</em> greeting to be the more historically accurate <em>Hello, world!</em> in <code>src/templates/index.rs</code>, and watch as the CLI automatically recompiles your app and reloads the browser so you can see your changes!</p>\\n<p><em>Note: this simple change will probably take a fair while to recompile for. See <a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/compilation-times\\">here</a> for how to optimize this.</em> </p>\\n<p>Finally, try running <code>perseus deploy</code>, and you'll get a <code>pkg/</code> folder at the root of your project with a <code>server</code> executable, which you can run to serve your app in production! With any Perseus app, that <code>pkg/</code> folder can be sent to a server and hosted live!</p>\\n","sidebar_content":"<h1>Introduction</h1>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/intro\\">Introduction</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/what-is-perseus\\">What is Perseus?</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/intro\\">Getting Started</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/installation\\">Installation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/first-app\\">Your First App</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles\\">Core Principles</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/tutorials/second-app\\">Your Second App</a></li>\\n</ul>\\n<h1>Reference</h1>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/features\\">Feature Discovery Terminal</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/compilation-times\\">Improving Compilation Times</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/state-generation\\">State Generation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/live-reloading-and-hsr\\">Live Reloading and HSR</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/i18n\\">Internationalization</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/hydration\\">Hydration</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/exporting\\">Static Exporting</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/plugins\\">Plugins</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/deploying\\">Deploying</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/architecture\\">Architecture Details</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/router\\">Router</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/initial_subsequent_loads\\">Initial vs. Subsequent Loads</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/migrating\\">Migrating from v0.3.x</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/faq\\">Common Pitfalls and Known Bugs</a></li>\\n</ul>\\n","status":"Next","manifest":{"0.2.x":{"state":"outdated","git":"v0.2.3","docs_rs":"0.2"},"0.1.x":{"state":"outdated","git":"v0.1.4","docs_rs":"0.1"},"0.3.0-0.3.3":{"state":"outdated","git":"v0.3.3","docs_rs":"0.3.3"},"0.4.x":{"state":"beta","git":"HEAD","docs_rs":"0.4.0-beta"},"0.3.4":{"state":"stable","git":"eccf137032fbe8e6507be9e9317edc16e7576a4f","docs_rs":"0.3"}},"current_version":"next"}`;</script>
            </head><body  class="bg-white dark:bg-navy"><div><div id="root"><div id="__perseus_content_initial" class="__perseus_content"><header data-hk="1.1" class="shadow-md sm:p-2 w-full bg-white dark:text-white dark:bg-navy mb-20"><div data-hk="1.2" class="flex justify-between"><a data-hk="1.3" class="justify-self-start self-center m-3 ml-5 text-md sm:text-2xl" href="en-US/">Perseus</a><div data-hk="1.4" class="md:hidden m-3 mr-5 tham tham-e-spin tham-w-6 "><div data-hk="1.5" class="tham-box"><div data-hk="1.6" class="dark:bg-white tham-inner"></div></div></div><nav data-hk="1.7" class="hidden md:flex"><ul data-hk="1.8" class="mr-5 flex"><li data-hk="2.0" class="m-3 p-1"><a data-hk="2.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="2.2" class="m-3 p-1"><a data-hk="2.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="2.4" class="m-3 p-1"><a data-hk="2.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul></nav></div><nav data-hk="1.9" id="mobile_nav_menu" class="md:hidden w-full text-center justify-center overflow-y-scroll hidden"><div data-hk="1.10" class="mr-5 overflow-y-scroll" style="max-height: 500px"><ul data-hk="1.11"><li data-hk="3.0" class="m-3 p-1"><a data-hk="3.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="3.2" class="m-3 p-1"><a data-hk="3.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="3.4" class="m-3 p-1"><a data-hk="3.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul><hr data-hk="1.12"/><div data-hk="1.13" class="text-left p-3"><!--#--><!----><select data-hk="4.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="4.5" value="next" selected="">Next (unreleased)</option><option data-hk="4.0" value="0.4.x">v⁨0.4.x⁩ (beta)</option><option data-hk="4.6" value="0.3.4">v⁨0.3.4⁩ (stable)</option><option data-hk="4.1" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (outdated)</option><option data-hk="4.2" value="0.2.x">v⁨0.2.x⁩ (outdated)</option><option data-hk="4.3" value="0.1.x">v⁨0.1.x⁩ (outdated)</option></select><!--/--><div data-hk="1.14" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/intro">Getting Started</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/installation">Installation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/first-app">Your First App</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles">Core Principles</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/tutorials/second-app">Your Second App</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/features">Feature Discovery Terminal</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/state-generation">State Generation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/i18n">Internationalization</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/hydration">Hydration</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/exporting">Static Exporting</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/plugins">Plugins</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/deploying">Deploying</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/architecture">Architecture Details</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/router">Router</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></div></div></nav></header><div data-hk="1.15" class="mt-14 xs:mt-16 sm:mt-20 lg:mt-25 overflow-y-auto flex"><div data-hk="1.16" class="flex w-full"><div data-hk="1.17" class="h-full hidden md:block max-w-xs w-full border-r"><div data-hk="1.18" class="mr-5"><div data-hk="1.19" class="text-left text-black dark:text-white p-3"><aside data-hk="1.20"><!--#--><!----><select data-hk="5.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="5.5" value="next" selected="">Next (unreleased)</option><option data-hk="5.0" value="0.4.x">v⁨0.4.x⁩ (beta)</option><option data-hk="5.6" value="0.3.4">v⁨0.3.4⁩ (stable)</option><option data-hk="5.1" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (outdated)</option><option data-hk="5.2" value="0.2.x">v⁨0.2.x⁩ (outdated)</option><option data-hk="5.3" value="0.1.x">v⁨0.1.x⁩ (outdated)</option></select><!--/--><div data-hk="1.21" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/intro">Getting Started</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/installation">Installation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/first-app">Your First App</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles">Core Principles</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/tutorials/second-app">Your Second App</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/features">Feature Discovery Terminal</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/state-generation">State Generation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/i18n">Internationalization</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/hydration">Hydration</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/exporting">Static Exporting</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/plugins">Plugins</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/deploying">Deploying</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/architecture">Architecture Details</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/router">Router</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></aside></div></div></div><div data-hk="1.22" class="h-full flex w-full"><div data-hk="1.23" class="px-3 w-full sm:mr-auto sm:ml-auto sm:max-w-prose lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl"><!--#--><div data-hk="1.24" class="ring-4 ring-orange-400 p-4 rounded-lg mt-1"><div data-hk="1.25" class="flex flex-col 2xs:flex-row dark:text-white"><span data-hk="1.26" class="self-center mr-2" style="fill: #fb923c;"><svg xmlns="http://www.w3.org/2000/svg" height="auto" viewBox="0 0 24 24" width="2.25rem" fill="\#000000"><path d="M12 7c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1zm-.01-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm1-3h-2v-2h2v2z"/></svg></span><p data-hk="1.27">This version of the documentation is for a version that has not yet been released, and features documented here may not be present in the latest release. You can see the latest stable version of the docs <a href="en-US/docs/0.3.4/intro" class="underline">here</a>.</p></div></div><!--/--><main data-hk="1.28" class="text-black dark:text-white"><div data-hk="1.0" class="markdown"><h1>Your Second App</h1>
<p>Now it's time to build a more realistic app with Perseus, one that takes advantage of the state platform and uses a structure more similar to one you'd see in a real Perseus app. All the code for this tutorial is available <a href="https://github.com/arctic-hen7/perseus/tree/main/examples/core/basic">here</a>.</p>
<p>Note that this tutorial assumes you've already installed Rust and the Perseus CLI as per <a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/installation">these instructions</a>.</p>
<h2>Setup</h2>
<p>We can create a new Perseus project by going to some directory and running <code>perseus new my-app</code>, which will create a folder called <code>my-app/</code> and set it up for Perseus. Then, you can pop in there and make sure <code>Cargo.toml</code> looks like the following:</p>
<pre><code class="language-toml">[package]
name = &quot;my-app&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
perseus = { version = &quot;=0.4.0-beta.7&quot;, features = [ &quot;hydrate&quot; ] }
sycamore = &quot;=0.8.0-beta.7&quot;
serde = { version = &quot;1&quot;, features = [&quot;derive&quot;] }
serde_json = &quot;1&quot;

[target.'cfg(not(target_arch = &quot;wasm32&quot;))'.dependencies]
tokio = { version = &quot;1&quot;, features = [ &quot;macros&quot;, &quot;rt&quot;, &quot;rt-multi-thread&quot; ] }
perseus-warp = { version = &quot;=0.4.0-beta.7&quot;, features = [ &quot;dflt-server&quot; ] }

[target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies]

</code></pre>
<p>This is almost identical to the <a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/getting-started/first-app">first app</a> we built, so we'll skip over further explanation here. Recall though that this structure of declaring engine-side and browser-side dependencies separately is a fairly standard pattern in Perseus.</p>
<p>Next, create some files and folders so that your project tree looks like this:</p>
<pre><code>├── Cargo.toml
└── src
    ├── error_pages.rs
    ├── lib.rs
    └── templates
        ├── about.rs
        ├── index.rs
        └── mod.rs
</code></pre>
<p>Great, now you've got your basic directory setup for a Perseus project! For a quick foreshadowing, we'll be putting our app declaration in <code>src/lib.rs</code>, our error pages (for 404 etc.) in <code>src/error_pages.rs</code>, adn each of the files in <code>templates/</code> will correspond to a template (which could generate as many pages as it wants, see <a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles">here</a> for an explanation of this).</p>
<p>Finally, add the following to the top of <code>src/lib.rs</code> so that Cargo knows about this structure:</p>
<pre><code class="language-rust">mod error_pages;
mod templates;
</code></pre>
<p>And then make <code>src/templates/mod.rs</code> look like the following to declare the files in there to Cargo:</p>
<pre><code class="language-rust">pub mod about;
pub mod index;

</code></pre>
<p>The reason these are <code>pub mod</code>s is so that we can access them from <code>lib.rs</code> easily.</p>
<h2>Index template</h2>
<p>Let's jump right into the code of this app! We'll start with the index template, which will render the landing page of our site. The code for this is accordingly in <code>src/templates/index.rs</code>.</p>
<p>In <code>src/templates/index.rs</code>, dump the following code (replacing the auto-generated code):</p>
<pre><code class="language-rust">use perseus::{Html, RenderFnResultWithCause, SsrNode, Template};
use sycamore::prelude::{view, Scope, View};

#[perseus::make_rx(IndexPageStateRx)]
pub struct IndexPageState {
    pub greeting: String,
}

#[perseus::template_rx]
pub fn index_page&lt;'a, G: Html&gt;(cx: Scope&lt;'a&gt;, state: IndexPageStateRx&lt;'a&gt;) -&gt; View&lt;G&gt; {
    view! { cx,
        p { (state.greeting.get()) }
        a(href = &quot;about&quot;, id = &quot;about-link&quot;) { &quot;About!&quot; }
    }
}

pub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {
    Template::new(&quot;index&quot;)
        .build_state_fn(get_build_state)
        .template(index_page)
        .head(head)
}

#[perseus::head]
pub fn head(cx: Scope, _props: IndexPageState) -&gt; View&lt;SsrNode&gt; {
    view! { cx,
        title { &quot;Index Page | Perseus Example – Basic&quot; }
    }
}

#[perseus::build_state]
pub async fn get_build_state(
    _path: String,
    _locale: String,
) -&gt; RenderFnResultWithCause&lt;IndexPageState&gt; {
    Ok(IndexPageState {
        greeting: &quot;Hello World!&quot;.to_string(),
    })
}

</code></pre>
<p>This is much more complex than our first app, so let's dive into explanation. Note that the imports at the top of this file will be explained as we go.</p>
<p>The first thing then is <code>IndexPageState</code>, which is our first usage of Perseus' state platform. As explained <a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/core-principles">here</a>, a page in Perseus is produced from a template and some state. In this template, we'll only be rendering one template, but it will use some state to demonstrate how we can execute arbitrary code when we build our app to create pages. In this case, our state is dead simple, containing only one property, <code>greeting</code>, which is a <code>String</code>.</p>
<p>Importantly, we've annotated that with <code>#[perseus::make_rx(IndexPageStateRx)]</code>, which will create a version of this <code>struct</code> that uses Sycamore's <code>Signal</code>s: a reactive version. If you're unfamiliar with Sycamore's reactivity system, you should read <a href="https://sycamore-rs.netlify.app/docs/basics/reactivity">this</a> quickly before continuing.</p>
<p>Next, we create a function called <code>index_page</code>, which we annotate with <code>#[perseus::template_rx]</code>. That macro is used for declaring templates, and you can think of it like black box that makes things work.</p>
<details>
<summary>Details??</summary>
<p>What that macro actually does depends on the complexity of your template, but the core purpose is to make sure it gets the right state. Internally, Perseus passes around all state as serialized <code>String</code>s, since it needs to be sent over the network from the server. This macro performs deserialization for you, and registers the state with the app-wide state management system if it's the first load of it. If not, it will restore previous state, meaning, for example, that user inputs can retain their content even if the user goes to three other pages in your app before returning, with no extra code from you. The workings of these macros aren't too complex, but they are extremely unergonomic.</p>
<p>If you really viscerally hate macros though, then you <em>could</em> implement the under-the-hood stuff manually based on <a href="">this file</a>, but we seriously wouldn't recommend it. Also, that code could change at any time, which means any update could be a breaking change for you.</p>
<p><em>Note: these macros are progressively becoming less and less important to Perseus. Eventually, we hope to reduce them to the absolute minimum necessary for functionality.</em></p>
</details>
<p>This function takes two arguments: a Sycamore reactive scope and the reactive version of the state, which both share the same lifetime <code>'a</code>. Don't worry though, we won't have to worry about these lifetimes most of the time, Sycamore is very well-designed to make them stay out of our way! They're just there to make things much more ergonomic and speedy. (In older version,s you had to <code>.clone()</code> <em>everything</em>.)</p>
<p>Finally, we produce a Sycamore <a href="https://docs.rs/sycamore/0.4.0-beta/sycamore/struct.View.html"><code>View</code></a>, which will render content to the user's browser. Notably, this function is generic over a type parameter <code>G: Html</code>, which we use to make sure this code can be run on both the engine-side and the browser-side.</p>
<details>
<summary>Wait up, why are my templates being rendered on the engine-side?</summary>
<p>To improve performance <em>dramatically</em>, Perseus renders all pages on the engine-side before your app ever gets to users, creating fully-built HTML that can be sent down at a moment's notice, meaning users see pages quickly, and then they become interactive a moment later. Generally, this is agreed to be much better than users having to wait potentially several seconds to see anything on your site at all. </p>
<p>As a result of this, the code in any template function must be able to run on both the browser-side and the server-side. But, you can always use <code>#[cfg(target_arch = &quot;wasm32&quot;)]</code> to gate browser-only code, or <code>#[cfg(not(target_arch = &quot;wasm32&quot;))]</code> to gate engine-only code.</p>
</details>
<p>Inside this function, we use Sycamore's <a href="https://docs.rs/sycamore/0.4.0-beta/sycamore/macro.view.html"><code>view!</code></a> macro to a create a view for the user, which will be displayed in their browser. We provide the reactive scope <code>cx</code>, and then we have just two items we're rendering. The second is a simple link to <code>about</code>, which is the same as <code>/about</code>, but without the absolutism that the route has to be at the top-level (instead, it will be relative to the rest of the site, which lets you serve your entire app inside another website trivially --- it's exactly what's done on this website!).</p>
<p>The first element is a paragraph that contains some dynamic content. Specifically, the value of that <code>greeting</code> property in our state. Notably, we're calling <code>.get()</code> on that, because, remember, we're using the reactive version, so it's not a <code>String</code> anymore, it's a <code>&amp;'a Signal&lt;String&gt;</code>! Again, you don't need to worry about the lifetimes, Sycamore makes all that seamless for you.</p>
<p>Notably, we could actually change this value at runtime if we wanted by calling <code>.set()</code>, but we won't do that in this example.</p>
<p>The next function we define is <code>get_template()</code>, which is fairly straightforward. It just declares a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.Template.html"><code>Template</code></a> with the necessary properties. Specifically, we define the function that actually renders the template as <code>index_page</code>, and the other two we'll get to now.</p>
<p>The first of those is the <code>head()</code> function, which is annotated as <code>#[perseus::head]</code> (which has similar responsibilities to <code>#[perseus::template_rx]</code>). In HTML, the language for creating views on the web, there are two main components to every page: the <code>&lt;body&gt;</code> and the <code>&lt;head&gt;</code>, the latter of which defines certain metadata, like the title, and any stylesheets you need, for example. If <code>index_page()</code> creates the body, then <code>head()</code> creates the head in this example. Notably, because the head is rendered only ahead of time, it can't be reactive. For that reason, it's passed the unreactive version of the state, and, rather than being generic over <code>Html</code>, it uses <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.SsrNode.html"><code>SsrNode</code></a>, which is specialized for the engine-side.</p>
<p>Because this function will only ever run on the engine-side, <code>#[perseus::head]</code> implies a target-gate to the engine (i.e. <code>#[cfg(not(target_arch = &quot;wasm32&quot;))]</code> is implicit). This means you can use engine-side dependencies here without any extra gating.</p>
<p>Finally, <code>get_build_state()</code> is responsible for generating an instance of <code>IndexPageState</code> that the template will be rendered with ahead of time on the engine-side. In this example, this logic is very simple, just generating a static <code>greeting</code>, but, in more complex apps, this might fetch information from a database, or it could run more complex computations.</p>
<p>For example, this very website uses build-time state generation to fetch the content for each of these docs pages from Markdown, rendering then to HTML, making the experience of both writing and viewing these docs as smooth as possible!</p>
<p>Importantly, that function takes two parameters: the path of the page (only relevant if you're using <em>build paths</em> too) and the locale (only relevant if you're using internationalization). Crucially, we return a <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.RenderFnResultWithCause.html"><code>RenderFnResultWithCause</code></a>, which is basically a glorified <code>Result</code> that lets you return any error type you want. But, we need to do one more thing if we get an error in state generation: we need to know who's responsible. You're probably familiar with the 404 HTTP status code, meaning the page wasn't found, but there are actually dozens of these, all with different meanings (like 418, which indicates the server is a teapot incapable of brewing coffee). The 4xx codes are for when the client caused the problems, and the 5xx codes are for when the server caused the problem. For the Perseus server to know which of these to send, it needs to know who was responsible, which <code>RenderFnResultWithCause</code> lets you declare. For an example of how to return errors from here like this, see <a href="">here</a>.</p>
<details>
<summary>But we're generating on the engine-side...</summary>
<p>It may seem like the client could never be responsible, since we're generating state at build time. That's true, unless you're using <em>incremental generation</em>, which is another state generation strategy that means functions like <code>get_build_state()</code> could be executed on the engine-side while the server is running in production, and the <code>path</code> parameter can be arbitrary. In these cases, the client can most certainly cause an error.</p>
<p>If none of that makes sense, don't worry, you can learn more about it <a href="">here</a>.</p>
</details>
<h2>About template</h2>
<p>With that done, we can build the second template of this app, which is much simpler! Add the following to <code>src/templates/about.rs</code>:</p>
<pre><code class="language-rust">use perseus::Template;
use sycamore::prelude::{view, Html, Scope, SsrNode, View};

#[perseus::template_rx]
pub fn about_page&lt;G: Html&gt;(cx: Scope) -&gt; View&lt;G&gt; {
    view! { cx,
        p { &quot;About.&quot; }
    }
}

#[perseus::head]
pub fn head(cx: Scope) -&gt; View&lt;SsrNode&gt; {
    view! { cx,
        title { &quot;About Page | Perseus Example – Basic&quot; }
    }
}

pub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {
    Template::new(&quot;about&quot;).template(about_page).head(head)
}

</code></pre>
<p>This is basically a simpler version of the index template, with no state, and this template only defines a simple view and some metadata in the head.</p>
<p>Importantly, this illustrates that templates that don't take state don't have to have a second argument for their nonexistent state, the <code>#[perseus::template_rx]</code> macro is smart enough to handle that (and even a third argument for global state).</p>
<h2>Error pages</h2>
<p>Before we tie everything together, we've got to handle errors in this app! If the user goes to a page that doesn't exist right now, they'll be greeted with a stock error page designed for development debugging and fast iteration. In production, we won't even be allowed to build our app unless we set up some error handling.</p>
<p>Add the following to <code>src/error_pages.rs</code>:</p>
<pre><code class="language-rust">use perseus::{ErrorPages, Html};
use sycamore::view;

pub fn get_error_pages&lt;G: Html&gt;() -&gt; ErrorPages&lt;G&gt; {
    let mut error_pages = ErrorPages::new(
        |cx, url, status, err, _| {
            view! { cx,
                p { (format!(&quot;An error with HTTP code {} occurred at '{}': '{}'.&quot;, status, url, err)) }
            }
        },
        |cx, _, _, _, _| {
            view! { cx,
                title { &quot;Error&quot; }
            }
        },
    );
    error_pages.add_page(
        404,
        |cx, _, _, _, _| {
            view! { cx,
                p { &quot;Page not found.&quot; }
            }
        },
        |cx, _, _, _, _| {
            view! { cx,
                title { &quot;Not Found&quot; }
            }
        },
    );

    error_pages
}

</code></pre>
<p>This is a very simplistic error page setup, but it illustrates pretty well what error pages actually are in Perseus. Essentially, you define a new <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.ErrorPages.html"><code>ErrorPages</code></a> instance that's again generic over <code>Html</code> so it can work on the engine-side and the browser-side. In that <code>::new()</code> function, you need to provide a fallback page, because you're unlikely to provide a different error page for every possible HTTP status code. If one occurs that you haven't explicitly handled for, this fallback page will be used. Then, we use <code>.add_page()</code> to add another page for the 404 HTTP status code (page not found).</p>
<p>Notably, an error page is defined with a closure that takes four arguments: a reactive scope, the URL the user was on when the error occurred (which they'll stay on while the error page is displayed), the HTTP status code, teh actual <code>String</code> error message, and a translator (but we aren't using i18n, so we don't need this).</p>
<h2>Tying it all together</h2>
<p>Now, we can bring everything together in <code>src/main.rs</code>:</p>
<pre><code class="language-rust">mod error_pages;
mod templates;

use perseus::{Html, PerseusApp};

#[perseus::main(perseus_integration::dflt_server)]
pub fn main&lt;G: Html&gt;() -&gt; PerseusApp&lt;G&gt; {
    PerseusApp::new()
        .template(crate::templates::index::get_template)
        .template(crate::templates::about::get_template)
        .error_pages(crate::error_pages::get_error_pages)
}

</code></pre>
<p><strong>Important:</strong> replace <code>perseus_integration</code> here with <code>perseus_warp</code>! We use <code>perseus_integration</code> as an internal glue crate, and all code in these docs is sourced directly from the examples.</p>
<p>This is quite similar to the first app we built, though with a few more complexities. As in that app, we declare a <code>main()</code> function annotated with <code>#[perseus::main(...)]</code> to declare the entrypoint of our app. In there, we define the function that will spin up our server, here just using the <code>dflt_server</code> of our chosen integration. In the <code>Cargo.toml</code> above, we used <code>perseus_warp</code>, but you could trivially use any integration you like (or whatever works with your existing servers, which Perseus can extend).</p>
<p>Then, on our <a href="https://docs.rs/perseus/0.4.0-beta/perseus/struct.PerseusApp.html"><code>PerseusApp</code></a>, we define the two templates, and our error pages. Simple as that!</p>
<h2>Running it</h2>
<pre><code class="language-shell">perseus serve -w
</code></pre>
<p>This will compile your whole app (which might take a while for the first time), and then serve it at <a href="http://localhost:8080">http://localhost:8080</a>! If you take a look there, you should be greeted with <em>Hello World!</em> and a link to the about page, which should take you there without causing the browser to load a new page. This demonstrates how Perseus internally switches pages out with minimal requests to the server, using less bandwidth and enabling faster page transitions.</p>
<p>Now, try changing that <em>Hello World!</em> greeting to be the more historically accurate <em>Hello, world!</em> in <code>src/templates/index.rs</code>, and watch as the CLI automatically recompiles your app and reloads the browser so you can see your changes!</p>
<p><em>Note: this simple change will probably take a fair while to recompile for. See <a href="https://arctic-hen7.github.io/perseus/en-US/docs/next/reference/compilation-times">here</a> for how to optimize this.</em> </p>
<p>Finally, try running <code>perseus deploy</code>, and you'll get a <code>pkg/</code> folder at the root of your project with a <code>server</code> executable, which you can run to serve your app in production! With any Perseus app, that <code>pkg/</code> folder can be sent to a server and hosted live!</p>
</div></main></div></div></div></div><footer data-hk="1.29" class="w-full flex justify-center py-5 bg-gray-100 dark:bg-navy-deep"><p data-hk="1.30" class="dark:text-white mx-5 text-center"><span data-hk="1.31">© <a href="https://github.com/arctic-hen7" class="underline">arctic-hen7</a> ⁨2021⁩, see license <a href="https://github.com/arctic-hen7/perseus/blob/main/LICENSE" class="underline">here</a>.</span></p></footer><script data-hk="0.0" src=".perseus/static/prism.js" defer=""></script><script data-hk="0.1">window.Prism.highlightAll();</script></div></div></div></body></html>