<!DOCTYPE html>
<html  class="light"><head><base href="https://arctic-hen7.github.io/perseus/" />
<meta  charset="UTF-8"/><meta  name="viewport" content="width=device-width, initial-scale=1.0"/><link  rel="stylesheet" href=".perseus/static/tailwind.css"/><link  rel="stylesheet" href=".perseus/static/styles/style.css"/>
            <script type="module">window.__PERSEUS_RENDER_CFG = '{"docs/0.3.4/reference/testing/checkpoints":"docs","docs/reference/testing/fantoccini-basics":"docs","docs/0.3.4/reference/plugins/security":"docs","docs/next/reference/exporting":"docs","docs/0.4.x/reference/state-generation":"docs","docs/reference/deploying/intro":"docs","docs/0.3.4/reference/strategies/request-state":"docs","docs/0.4.x/reference/hydration":"docs","docs/0.3.0-0.3.3/views":"docs","docs/0.4.x/reference/compilation-times":"docs","docs/reference/error-pages":"docs","docs/reference/strategies/amalgamation":"docs","docs/0.3.0-0.3.3/testing/fantoccini-basics":"docs","docs/0.3.4/reference/templates/metadata-modification":"docs","docs/0.3.0-0.3.3/advanced/initial-loads":"docs","docs/0.3.4/reference/state/hsr":"docs","docs/0.3.4/advanced/subsequent-loads":"docs","docs/next/reference/architecture":"docs","docs/reference/plugins/control":"docs","docs/0.3.0-0.3.3/deploying/serverless":"docs","docs/0.3.4/reference/index-view":"docs","docs/reference/templates/setting-headers":"docs","docs/advanced/routing":"docs","docs/0.1.x/strategies/request_state":"docs","docs/reference/updating":"docs","docs/reference/templates/intro":"docs","docs/reference/state/rx":"docs","docs/reference/strategies/build-state":"docs","docs/0.4.x/reference/deploying":"docs","docs/reference/plugins/publishing":"docs","docs/0.1.x/strategies/revalidation":"docs","docs/0.2.x/testing/fantoccini-basics":"docs","docs/0.3.0-0.3.3/i18n/using":"docs","docs/0.3.0-0.3.3/testing/checkpoints":"docs","docs/0.3.4/advanced/arch":"docs","docs/0.3.4/reference/stores":"docs","docs/0.3.0-0.3.3/testing/manual":"docs","docs/next/getting-started/intro":"docs","docs/0.2.x/testing/intro":"docs","docs/0.3.4/intro":"docs","docs/0.3.4/tutorials/second-app":"docs","docs/reference/plugins/security":"docs","docs/reference/strategies/revalidation":"docs","docs/0.3.0-0.3.3/debugging":"docs","docs/0.1.x/intro":"docs","docs/advanced/initial-loads":"docs","docs/next/reference/migrating":"docs","docs/0.3.4/reference/deploying/serverful":"docs","docs/0.4.x/reference/plugins":"docs","docs/next/core-principles":"docs","docs/0.3.4/reference/engines":"docs","docs/0.3.0-0.3.3/templates/intro":"docs","docs/0.3.0-0.3.3/styling":"docs","docs/reference/deploying/size":"docs","docs/0.1.x/tutorials/first_app/template":"docs","docs/0.3.0-0.3.3/snooping":"docs","docs/0.2.x/i18n/defining":"docs","docs/0.1.x/arch":"docs","docs/reference/strategies/request-state":"docs","docs/0.1.x/setup":"docs","docs/what-is-perseus":"docs","docs/next/reference/state-generation":"docs","docs/0.3.4/reference/i18n/intro":"docs","docs/0.4.x/reference/exporting":"docs","docs/0.2.x/testing/manual":"docs","docs/next/reference/faq":"docs","docs/0.2.x/advanced/arch":"docs","docs/reference/strategies/build-paths":"docs","docs/0.2.x/testing/checkpoints":"docs","docs/reference/static-content":"docs","docs/0.2.x/second-app":"docs","docs/0.3.4/reference/updating":"docs","docs/0.4.x/core-principles":"docs","docs/next/reference/live-reloading-and-hsr":"docs","docs/0.3.4/core-principles":"docs","docs/0.2.x/hello-world":"docs","docs/0.1.x/strategies/intro":"docs","docs/0.3.4/advanced/initial-loads":"docs","docs/0.3.4/reference/i18n/defining":"docs","docs/0.3.4/reference/debugging":"docs","docs/0.1.x/strategies/build_paths":"docs","docs/0.2.x/deploying/exporting":"docs","docs/0.3.0-0.3.3/static-content":"docs","docs/reference/views":"docs","docs/next/getting-started/first-app":"docs","docs/next/tutorials/second-app":"docs","docs/0.1.x/building":"docs","docs/0.3.4/reference/static-content":"docs","docs/0.3.0-0.3.3/what-is-perseus":"docs","docs/reference/live-reloading":"docs","docs/0.3.0-0.3.3/advanced/routing":"docs","docs/reference/i18n/translations-managers":"docs","docs/0.3.4/advanced/intro":"docs","docs/0.3.0-0.3.3/testing/intro":"docs","docs/0.3.0-0.3.3/strategies/amalgamation":"docs","docs/0.2.x/strategies/revalidation":"docs","docs/0.4.x/reference/initial_subsequent_loads":"docs","docs/0.3.0-0.3.3/cli":"docs","docs/0.4.x/getting-started/installation":"docs","docs/0.3.4/reference/deploying/intro":"docs","docs/0.3.4/reference/plugins/using":"docs","docs/0.1.x/routing":"docs","docs/0.3.4/reference/i18n/using":"docs","docs/0.3.0-0.3.3/pitfalls-and-bugs":"docs","docs/next/reference/deploying":"docs","docs/0.3.0-0.3.3/advanced/intro":"docs","docs/reference/debugging":"docs","docs/0.2.x/debugging":"docs","docs/0.1.x/strategies/build_state":"docs","docs/0.3.0-0.3.3/ejecting":"docs","docs/0.3.0-0.3.3/advanced/arch":"docs","docs/reference/pitfalls-and-bugs":"docs","docs/0.2.x/deploying/intro":"docs","docs/reference/state/freezing":"docs","docs/0.3.4/reference/ejecting":"docs","docs/0.2.x/templates/intro":"docs","docs/0.4.x/what-is-perseus":"docs","docs/0.3.4/reference/state/idb-freezing":"docs","docs/0.3.4/reference/strategies/amalgamation":"docs","docs/0.3.4/reference/deploying/size":"docs","docs/tutorials/second-app":"docs","docs/0.3.4/reference/strategies/build-paths":"docs","docs/reference/plugins/writing":"docs","docs/0.3.0-0.3.3/plugins/publishing":"docs","docs/0.2.x/advanced/routing":"docs","docs/0.2.x/i18n/other-engines":"docs","docs/next/reference/hydration":"docs","docs/0.4.x/reference/architecture":"docs","docs/0.3.0-0.3.3/intro":"docs","docs/0.1.x/templates":"docs","docs/0.3.0-0.3.3/strategies/revalidation":"docs","docs/0.3.0-0.3.3/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/error-pages":"docs","docs/0.3.4/reference/views":"docs","docs/0.2.x/define-app":"docs","docs/0.3.4/what-is-perseus":"docs","docs/0.3.4/reference/plugins/publishing":"docs","docs/0.3.0-0.3.3/strategies/incremental":"docs","docs/0.3.4/reference/live-reloading":"docs","index":"index","docs/0.3.0-0.3.3/second-app":"docs","docs/0.2.x/advanced/subsequent-loads":"docs","comparisons":"comparisons","docs/0.3.0-0.3.3/exporting":"docs","docs/0.3.4/reference/deploying/docker":"docs","docs/0.2.x/ejecting":"docs","docs/reference/state/hsr":"docs","docs/0.3.4/reference/hydration":"docs","docs/0.3.0-0.3.3/deploying/size":"docs","docs/0.3.4/reference/templates/router-state":"docs","docs/0.3.0-0.3.3/plugins/security":"docs","docs/reference/testing/manual":"docs","docs/reference/testing/checkpoints":"docs","docs/0.3.0-0.3.3/plugins/functional":"docs","docs/0.3.0-0.3.3/hello-world":"docs","docs/reference/templates/router-state":"docs","docs/0.3.0-0.3.3/i18n/defining":"docs","docs/0.3.0-0.3.3/i18n/translations-managers":"docs","docs/reference/state/global":"docs","docs/0.1.x/serving":"docs","docs/0.3.4/reference/define-app":"docs","docs/0.3.4/reference/snooping":"docs","docs/0.3.4/reference/strategies/build-state":"docs","docs/0.2.x/what-is-perseus":"docs","docs/reference/engines":"docs","docs/core-principles":"docs","docs/intro":"docs","docs/0.2.x/cli":"docs","docs/reference/templates/metadata-modification":"docs","docs/0.3.4/reference/templates/setting-headers":"docs","docs/0.3.0-0.3.3/plugins/using":"docs","docs/0.4.x/tutorials/second-app":"docs","docs/0.2.x/templates/metadata-modification":"docs","docs/0.3.4/reference/cli":"docs","docs/reference/perseus-app":"docs","docs/reference/snooping":"docs","docs/0.2.x/i18n/using":"docs","docs/next/what-is-perseus":"docs","docs/0.3.4/reference/templates/intro":"docs","docs/0.1.x/tutorials/first_app/intro":"docs","docs/0.3.4/reference/pitfalls-and-bugs":"docs","docs/next/reference/initial_subsequent_loads":"docs","docs/tutorials/auth":"docs","docs/0.3.4/reference/i18n/translations-managers":"docs","docs/0.3.0-0.3.3/updating":"docs","docs/next/intro":"docs","docs/0.2.x/templates/setting-headers":"docs","docs/0.3.4/reference/strategies/intro":"docs","docs/advanced/subsequent-loads":"docs","docs/reference/strategies/intro":"docs","docs/reference/i18n/using":"docs","docs/0.3.4/reference/strategies/incremental":"docs","docs/reference/plugins/functional":"docs","docs/0.2.x/strategies/intro":"docs","docs/0.3.4/reference/state/global":"docs","docs/0.2.x/i18n/translations-managers":"docs","docs/tutorials/hello-world":"docs","docs/reference/stores":"docs","docs/reference/styling":"docs","docs/reference/plugins/tinker":"docs","docs/0.1.x/strategies/incremental":"docs","docs/0.3.4/tutorials/auth":"docs","docs/0.2.x/error-pages":"docs","docs/0.2.x/strategies/amalgamation":"docs","docs/0.3.0-0.3.3/deploying/serverful":"docs","docs/0.2.x/config-managers":"docs","docs/reference/define-app":"docs","docs/0.2.x/styling":"docs","docs/0.4.x/intro":"docs","docs/reference/server-communication":"docs","docs":"docs","docs/reference/deploying/serverless":"docs","docs/0.3.4/reference/plugins/functional":"docs","docs/0.3.4/reference/exporting":"docs","docs/0.3.4/reference/plugins/intro":"docs","docs/reference/i18n/intro":"docs","docs/0.3.4/reference/testing/manual":"docs","docs/next/reference/compilation-times":"docs","docs/0.3.4/reference/perseus-app":"docs","docs/reference/deploying/docker":"docs","docs/0.3.4/reference/plugins/control":"docs","docs/0.3.0-0.3.3/plugins/intro":"docs","docs/0.3.4/reference/deploying/serverless":"docs","docs/0.2.x/intro":"docs","docs/0.3.0-0.3.3/deploying/docker":"docs","docs/0.2.x/strategies/build-paths":"docs","docs/0.3.4/reference/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/strategies/intro":"docs","docs/reference/strategies/incremental":"docs","docs/0.4.x/features":"docs","docs/0.3.0-0.3.3/advanced/subsequent-loads":"docs","docs/advanced/intro":"docs","docs/reference/state/idb-freezing":"docs","docs/0.1.x/cli":"docs","docs/0.4.x/reference/live-reloading-and-hsr":"docs","docs/0.2.x/advanced/intro":"docs","docs/0.2.x/updating":"docs","docs/0.3.0-0.3.3/server-communication":"docs","docs/0.4.x/reference/i18n":"docs","docs/0.2.x/strategies/build-state":"docs","docs/0.3.0-0.3.3/plugins/writing":"docs","docs/0.3.4/reference/plugins/writing":"docs","docs/0.1.x/integrations/actix-web":"docs","docs/0.3.4/tutorials/hello-world":"docs","docs/0.3.4/advanced/route-announcer":"docs","docs/0.3.0-0.3.3/advanced/define_app":"docs","docs/0.3.4/reference/i18n/other-engines":"docs","docs/0.3.0-0.3.3/i18n/intro":"docs","docs/0.4.x/reference/migrating":"docs","docs/0.4.x/reference/router":"docs","docs/0.3.4/reference/error-pages":"docs","docs/advanced/route-announcer":"docs","docs/0.3.4/advanced/routing":"docs","docs/next/features":"docs","docs/0.2.x/static-content":"docs","docs/0.4.x/reference/faq":"docs","docs/0.2.x/views":"docs","docs/0.2.x/strategies/incremental":"docs","docs/0.3.0-0.3.3/stores":"docs","docs/next/reference/i18n":"docs","docs/0.1.x/config_managers":"docs","docs/0.4.x/getting-started/intro":"docs","docs/reference/index-view":"docs","docs/0.3.0-0.3.3/templates/metadata-modification":"docs","docs/0.3.4/reference/testing/intro":"docs","docs/next/getting-started/installation":"docs","docs/0.3.4/reference/testing/fantoccini-basics":"docs","docs/reference/ejecting":"docs","docs/next/reference/router":"docs","docs/0.1.x/tutorials/first_app/setup":"docs","docs/0.3.0-0.3.3/deploying/intro":"docs","docs/next/reference/plugins":"docs","docs/0.3.0-0.3.3/templates/setting-headers":"docs","docs/advanced/arch":"docs","docs/reference/cli":"docs","docs/0.3.4/reference/server-communication":"docs","docs/0.3.4/reference/state/rx":"docs","docs/0.3.0-0.3.3/strategies/request-state":"docs","docs/reference/plugins/intro":"docs","plugins":"plugins","docs/0.3.4/reference/styling":"docs","docs/0.2.x/i18n/intro":"docs","docs/reference/plugins/using":"docs","docs/reference/testing/intro":"docs","docs/0.3.4/reference/plugins/tinker":"docs","docs/reference/i18n/other-engines":"docs","docs/0.4.x/getting-started/first-app":"docs","docs/reference/exporting":"docs","docs/0.3.0-0.3.3/strategies/build-state":"docs","docs/reference/deploying/serverful":"docs","docs/0.1.x/error_pages":"docs","docs/0.3.4/reference/strategies/revalidation":"docs","docs/0.3.0-0.3.3/plugins/tinker":"docs","docs/0.2.x/advanced/initial-loads":"docs","docs/reference/hydration":"docs","docs/reference/i18n/defining":"docs","docs/0.3.0-0.3.3/strategies/build-paths":"docs","docs/0.3.4/reference/state/freezing":"docs","docs/0.2.x/strategies/request-state":"docs","docs/0.3.0-0.3.3/define-app":"docs","docs/reference/deploying/relative-paths":"docs","docs/0.3.0-0.3.3/plugins/control":"docs","docs/0.3.0-0.3.3/hydration":"docs","docs/0.1.x/tutorials/first_app/app":"docs","docs/0.3.0-0.3.3/i18n/other-engines":"docs"}';

        import init from "https://arctic-hen7.github.io/perseus/.perseus/bundle.js";
        async function main() {
            await init("https://arctic-hen7.github.io/perseus/.perseus/bundle.wasm");
        }
        main();
        

window.__PERSEUS_GLOBAL_STATE = `None`;</script>
            <!--PERSEUS_INTERPOLATED_HEAD_BEGINS-->
            
<title>Deploying | Perseus Docs</title><link rel="stylesheet" href=".perseus/static/styles/markdown.css"/><link rel="stylesheet" href=".perseus/static/styles/docs_links_markdown.css"/><link rel="stylesheet" href=".perseus/static/prism.css"/>
            <script>
window.__PERSEUS_INITIAL_STATE = `{"title":"Deploying","content":"<h1>Deploying</h1>\\n<p>When you've built your app, and you're ready to go to production with it, Perseus provides some nifty tools to make your life easy. First off, you'll notice that all your files are sequestered away in <code>dist/</code>, which is all very well for keeping a ton of cached stuff out of your way, but not very useful for getting production binaries!</p>\\n<p>When you're ready for production, you should run <code>perseus deploy</code>, which will build your entire app in release mode (optimizing for size in the browser and speed on the server, which we'll return to), which will take quite a while. This is a good time to make yourself a beverage of some form. When it's done, you'll get a <code>pkg/</code> folder with some stuff inside. The main thing is a file <code>pkg/server</code>, which is a binary that will run your app's server, using the rest of the stuff in there for all sorts of purposes. Unless you really know what you're doing, you shouldn't add files here or rearrange things, because that can send the production server a little crazy (it's very particular).</p>\\n<p>If you don't need a server for your app, you can use <code>perseus deploy -e</code>, which will produce a set of static files to be uploaded to your file host of choice.</p>\\n<h2>Optimizations</h2>\\n<p>Of course, when you're deploying your app, you want it to be as fast as possible. On the engine-side, this is handled automatically by Rust, which will naturally produce super-fast binaries. On the browser-side, there are problems though. This is because of the way the internet works --- before your users can run your super-fast code, they need to download it first. That download process is what's involved in loading your app, which is generally the indicator of speed on the web. That means we actually improve the speed of your app by optimizing more aggreassively for the <em>size</em> of your app, thus minimizing download times and making your app load faster.</p>\\n<p>With JavaScript, you can 'chunk' your app into many different files that are loaded at the appropriate times, but no such mechanisms exists yet for Wasm of any kind, which means your final <code>bundle.wasm</code> will be big. This is often used as a criticism of Wasm: the Perseus basic example produces a bundle that's over 200kb, where a JavaScript equivalent would be a tenth of the size. However, this comparison is flawed, since JavaScript is actually slower to execute. It's an oversimplification, but you can think of it like this: JS needs to be 'compiled' in the browser, whereas Wasm is already compiled. For that reason, it's better to compare Wasm file sizes to image file sizes (another type of file that doesn't need as much browser processing). In fact, that over 200kb bundle is probably faster than the tenth-of-the-size JS.</p>\\n<p>If you're getting into real strife with your bundle sizes though, you can, theoretically, split out your app into multiple components by literally building different parts of your website as different apps. This should be an absolute last resort though, and we have never come across an app that was big enough to need this. (Remember that Perseus will still give your users a page very quickly, it's just the interactivity that might take a little longer --- as in a few milliseconds longer.)</p>\\n<p>Very usefully, the Perseus CLI automatically applies several optimizations when you build in release mode. Specifically, Cargo's optimization level is set to <code>z</code>, which means it will aggressively optimize for size at the expense of speed, which actually means a faster site, due to faster load times for the Wasm bundle. Additionally, <code>codegen-units</code> is set to <code>1</code>, which slows down compilation with <code>perseus deploy</code>, but both speeds up, and reduces the size of, the final bundle.</p>\\n<p>Notably, these optimizations are enabled through the <code>RUSTFLAGS</code> environment variable on the Wasm build, and only in release-mode (e.g. <code>perseus deploy</code>). If you want to tweak these changes, you can directly override the value of that environment variable in this context (i.e. you can apply your own optimization settings) by setting the <code>PERSEUS_WASM_RELEASE_RUSTFLAGS</code> environment variable. This takes the same format as <code>RUSTFLAGS</code>, and its default value is <code>-C opt-level=z -C codegen-units=1</code>.</p>\\n<p><em>Note: the reason these optimizations are applied through <code>RUSTFLAGS</code> rather than <code>Cargo.toml</code> is because Cargo doesn't yet support target-specific release profiles, and we only want to optimize for size on the browser-side. Applying the same optimizations to the server would slow things down greatly!</em></p>\\n<p>The next thing you can do is switch to <code>wee_alloc</code>, an alternative allocator designed for the web that produces less efficient, but smaller bundles. Again though, that lower efficiency is barely noticeable, while every kilobyte you can shave off the bundle's size leads to a notably faster load speed. Importantly, you still want to retain that efficiency on the server, so it's very important to only use <code>wee_alloc</code> on the browser-side, which you can do by adding the following to the very top of your <code>lib.rs</code>:</p>\\n<pre><code class=\\"language-rust\\">#[cfg(target_arch = &quot;wasm32&quot;)]\\n#[global_allocator]\\nstatic ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;\\n</code></pre>\\n<p>To make this work, you should also add the following to your <code>Cargo.toml</code> under the <code>[target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies]</code> section (for browser-only dependencies):</p>\\n<pre><code class=\\"language-toml\\">wee_alloc = &quot;0.4&quot;\\n</code></pre>\\n<p>Finally, for another small cut to bundle sizes, you can set <code>wasm-opt</code>, a tool that <code>wasm-pack</code> runs automatically (and the Perseus CLI runs <code>wasm-pack</code>) to optimize for size by adding the following to your <code>Cargo.toml</code>:</p>\\n<pre><code class=\\"language-toml\\">[package.metadata.wasm-pack.profile.release]\\nwasm-opt = [ &quot;-Oz&quot; ]\\n</code></pre>\\n<p>You can find more information about optimizing Wasm bundle sizes <a href=\\"https://rustwasm.github.io/book/reference/code-size.html#optimizing-builds-for-code-size\\">here</a>.</p>\\n","sidebar_content":"<h1>Introduction</h1>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/intro\\">Introduction</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/what-is-perseus\\">What is Perseus?</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/intro\\">Getting Started</a>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/installation\\">Installation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/first-app\\">Your First App</a></li>\\n</ul>\\n</li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/core-principles\\">Core Principles</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/tutorials/second-app\\">Your Second App</a></li>\\n</ul>\\n<h1>Reference</h1>\\n<ul>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/features\\">Feature Discovery Terminal</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/compilation-times\\">Improving Compilation Times</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/state-generation\\">State Generation</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr\\">Live Reloading and HSR</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/i18n\\">Internationalization</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/hydration\\">Hydration</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/exporting\\">Static Exporting</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/plugins\\">Plugins</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/deploying\\">Deploying</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/architecture\\">Architecture Details</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/router\\">Router</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads\\">Initial vs. Subsequent Loads</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/migrating\\">Migrating from v0.3.x</a></li>\\n<li><a href=\\"https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/faq\\">Common Pitfalls and Known Bugs</a></li>\\n</ul>\\n","status":"Beta","manifest":{"0.2.x":{"state":"outdated","git":"v0.2.3","docs_rs":"0.2"},"0.1.x":{"state":"outdated","git":"v0.1.4","docs_rs":"0.1"},"0.3.0-0.3.3":{"state":"outdated","git":"v0.3.3","docs_rs":"0.3.3"},"0.4.x":{"state":"beta","git":"HEAD","docs_rs":"0.4.0-beta"},"0.3.4":{"state":"stable","git":"eccf137032fbe8e6507be9e9317edc16e7576a4f","docs_rs":"0.3"}},"current_version":"0.4.x"}`;</script>
            </head><body  class="bg-white dark:bg-navy"><div><div id="root"><div id="__perseus_content_initial" class="__perseus_content"><header data-hk="1.1" class="shadow-md sm:p-2 w-full bg-white dark:text-white dark:bg-navy mb-20"><div data-hk="1.2" class="flex justify-between"><a data-hk="1.3" class="justify-self-start self-center m-3 ml-5 text-md sm:text-2xl" href="en-US/">Perseus</a><div data-hk="1.4" class="md:hidden m-3 mr-5 tham tham-e-spin tham-w-6 "><div data-hk="1.5" class="tham-box"><div data-hk="1.6" class="dark:bg-white tham-inner"></div></div></div><nav data-hk="1.7" class="hidden md:flex"><ul data-hk="1.8" class="mr-5 flex"><li data-hk="2.0" class="m-3 p-1"><a data-hk="2.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="2.2" class="m-3 p-1"><a data-hk="2.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="2.4" class="m-3 p-1"><a data-hk="2.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul></nav></div><nav data-hk="1.9" id="mobile_nav_menu" class="md:hidden w-full text-center justify-center overflow-y-scroll hidden"><div data-hk="1.10" class="mr-5 overflow-y-scroll" style="max-height: 500px"><ul data-hk="1.11"><li data-hk="3.0" class="m-3 p-1"><a data-hk="3.1" href="en-US/docs" class="px-2">Docs</a></li><li data-hk="3.2" class="m-3 p-1"><a data-hk="3.3" href="en-US/comparisons" class="px-2">Comparisons</a></li><li data-hk="3.4" class="m-3 p-1"><a data-hk="3.5" href="en-US/plugins" class="px-2">Plugins</a></li></ul><hr data-hk="1.12"/><div data-hk="1.13" class="text-left p-3"><!--#--><!----><select data-hk="4.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="4.5" value="next">Next (unreleased)</option><option data-hk="4.0" value="0.4.x" selected="">v⁨0.4.x⁩ (beta)</option><option data-hk="4.6" value="0.3.4">v⁨0.3.4⁩ (stable)</option><option data-hk="4.1" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (outdated)</option><option data-hk="4.2" value="0.2.x">v⁨0.2.x⁩ (outdated)</option><option data-hk="4.3" value="0.1.x">v⁨0.1.x⁩ (outdated)</option></select><!--/--><div data-hk="1.14" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/intro">Getting Started</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/installation">Installation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/first-app">Your First App</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/core-principles">Core Principles</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/tutorials/second-app">Your Second App</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/features">Feature Discovery Terminal</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/state-generation">State Generation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/i18n">Internationalization</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/hydration">Hydration</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/exporting">Static Exporting</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/plugins">Plugins</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/deploying">Deploying</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/architecture">Architecture Details</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/router">Router</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></div></div></nav></header><div data-hk="1.15" class="mt-14 xs:mt-16 sm:mt-20 lg:mt-25 overflow-y-auto flex"><div data-hk="1.16" class="flex w-full"><div data-hk="1.17" class="h-full hidden md:block max-w-xs w-full border-r"><div data-hk="1.18" class="mr-5"><div data-hk="1.19" class="text-left text-black dark:text-white p-3"><aside data-hk="1.20"><!--#--><!----><select data-hk="5.4" class="p-2 rounded-md text-white bg-indigo-500"><option data-hk="5.5" value="next">Next (unreleased)</option><option data-hk="5.0" value="0.4.x" selected="">v⁨0.4.x⁩ (beta)</option><option data-hk="5.6" value="0.3.4">v⁨0.3.4⁩ (stable)</option><option data-hk="5.1" value="0.3.0-0.3.3">v⁨0.3.0-0.3.3⁩ (outdated)</option><option data-hk="5.2" value="0.2.x">v⁨0.2.x⁩ (outdated)</option><option data-hk="5.3" value="0.1.x">v⁨0.1.x⁩ (outdated)</option></select><!--/--><div data-hk="1.21" class="docs-links-markdown"><h1>Introduction</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/intro">Introduction</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/what-is-perseus">What is Perseus?</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/intro">Getting Started</a>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/installation">Installation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/getting-started/first-app">Your First App</a></li>
</ul>
</li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/core-principles">Core Principles</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/tutorials/second-app">Your Second App</a></li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/features">Feature Discovery Terminal</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/compilation-times">Improving Compilation Times</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/state-generation">State Generation</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/live-reloading-and-hsr">Live Reloading and HSR</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/i18n">Internationalization</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/hydration">Hydration</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/exporting">Static Exporting</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/plugins">Plugins</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/deploying">Deploying</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/architecture">Architecture Details</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/router">Router</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/initial_subsequent_loads">Initial vs. Subsequent Loads</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/migrating">Migrating from v0.3.x</a></li>
<li><a href="https://arctic-hen7.github.io/perseus/en-US/docs/0.4.x/reference/faq">Common Pitfalls and Known Bugs</a></li>
</ul>
</div></aside></div></div></div><div data-hk="1.22" class="h-full flex w-full"><div data-hk="1.23" class="px-3 w-full sm:mr-auto sm:ml-auto sm:max-w-prose lg:max-w-3xl xl:max-w-4xl 2xl:max-w-5xl"><!--#--><div data-hk="1.24" class="ring-4 ring-yellow-300 p-4 rounded-lg mt-1"><div data-hk="1.25" class="flex flex-col 2xs:flex-row dark:text-white"><span data-hk="1.26" class="self-center mr-2" style="fill: #fcd34d;"><svg xmlns="http://www.w3.org/2000/svg" height="auto" viewBox="0 0 24 24" width="2.25rem" fill="\#000000"><path d="M12 5.99L19.53 19H4.47L12 5.99M2.74 18c-.77 1.33.19 3 1.73 3h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18zM11 11v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zm0 5h2v2h-2z"/></svg></span><p data-hk="1.27">This version of the documentation is for a version that has only been released in beta, and is not yet stable. Features documented here may not be present in the latest stable version, and they're subject to rapid and drastic change. You can see the latest stable version of the docs <a href="en-US/docs/0.3.4/intro" class="underline">here</a>.</p></div></div><!--/--><main data-hk="1.28" class="text-black dark:text-white"><div data-hk="1.0" class="markdown"><h1>Deploying</h1>
<p>When you've built your app, and you're ready to go to production with it, Perseus provides some nifty tools to make your life easy. First off, you'll notice that all your files are sequestered away in <code>dist/</code>, which is all very well for keeping a ton of cached stuff out of your way, but not very useful for getting production binaries!</p>
<p>When you're ready for production, you should run <code>perseus deploy</code>, which will build your entire app in release mode (optimizing for size in the browser and speed on the server, which we'll return to), which will take quite a while. This is a good time to make yourself a beverage of some form. When it's done, you'll get a <code>pkg/</code> folder with some stuff inside. The main thing is a file <code>pkg/server</code>, which is a binary that will run your app's server, using the rest of the stuff in there for all sorts of purposes. Unless you really know what you're doing, you shouldn't add files here or rearrange things, because that can send the production server a little crazy (it's very particular).</p>
<p>If you don't need a server for your app, you can use <code>perseus deploy -e</code>, which will produce a set of static files to be uploaded to your file host of choice.</p>
<h2>Optimizations</h2>
<p>Of course, when you're deploying your app, you want it to be as fast as possible. On the engine-side, this is handled automatically by Rust, which will naturally produce super-fast binaries. On the browser-side, there are problems though. This is because of the way the internet works --- before your users can run your super-fast code, they need to download it first. That download process is what's involved in loading your app, which is generally the indicator of speed on the web. That means we actually improve the speed of your app by optimizing more aggreassively for the <em>size</em> of your app, thus minimizing download times and making your app load faster.</p>
<p>With JavaScript, you can 'chunk' your app into many different files that are loaded at the appropriate times, but no such mechanisms exists yet for Wasm of any kind, which means your final <code>bundle.wasm</code> will be big. This is often used as a criticism of Wasm: the Perseus basic example produces a bundle that's over 200kb, where a JavaScript equivalent would be a tenth of the size. However, this comparison is flawed, since JavaScript is actually slower to execute. It's an oversimplification, but you can think of it like this: JS needs to be 'compiled' in the browser, whereas Wasm is already compiled. For that reason, it's better to compare Wasm file sizes to image file sizes (another type of file that doesn't need as much browser processing). In fact, that over 200kb bundle is probably faster than the tenth-of-the-size JS.</p>
<p>If you're getting into real strife with your bundle sizes though, you can, theoretically, split out your app into multiple components by literally building different parts of your website as different apps. This should be an absolute last resort though, and we have never come across an app that was big enough to need this. (Remember that Perseus will still give your users a page very quickly, it's just the interactivity that might take a little longer --- as in a few milliseconds longer.)</p>
<p>Very usefully, the Perseus CLI automatically applies several optimizations when you build in release mode. Specifically, Cargo's optimization level is set to <code>z</code>, which means it will aggressively optimize for size at the expense of speed, which actually means a faster site, due to faster load times for the Wasm bundle. Additionally, <code>codegen-units</code> is set to <code>1</code>, which slows down compilation with <code>perseus deploy</code>, but both speeds up, and reduces the size of, the final bundle.</p>
<p>Notably, these optimizations are enabled through the <code>RUSTFLAGS</code> environment variable on the Wasm build, and only in release-mode (e.g. <code>perseus deploy</code>). If you want to tweak these changes, you can directly override the value of that environment variable in this context (i.e. you can apply your own optimization settings) by setting the <code>PERSEUS_WASM_RELEASE_RUSTFLAGS</code> environment variable. This takes the same format as <code>RUSTFLAGS</code>, and its default value is <code>-C opt-level=z -C codegen-units=1</code>.</p>
<p><em>Note: the reason these optimizations are applied through <code>RUSTFLAGS</code> rather than <code>Cargo.toml</code> is because Cargo doesn't yet support target-specific release profiles, and we only want to optimize for size on the browser-side. Applying the same optimizations to the server would slow things down greatly!</em></p>
<p>The next thing you can do is switch to <code>wee_alloc</code>, an alternative allocator designed for the web that produces less efficient, but smaller bundles. Again though, that lower efficiency is barely noticeable, while every kilobyte you can shave off the bundle's size leads to a notably faster load speed. Importantly, you still want to retain that efficiency on the server, so it's very important to only use <code>wee_alloc</code> on the browser-side, which you can do by adding the following to the very top of your <code>lib.rs</code>:</p>
<pre><code class="language-rust">#[cfg(target_arch = &quot;wasm32&quot;)]
#[global_allocator]
static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;
</code></pre>
<p>To make this work, you should also add the following to your <code>Cargo.toml</code> under the <code>[target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies]</code> section (for browser-only dependencies):</p>
<pre><code class="language-toml">wee_alloc = &quot;0.4&quot;
</code></pre>
<p>Finally, for another small cut to bundle sizes, you can set <code>wasm-opt</code>, a tool that <code>wasm-pack</code> runs automatically (and the Perseus CLI runs <code>wasm-pack</code>) to optimize for size by adding the following to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[package.metadata.wasm-pack.profile.release]
wasm-opt = [ &quot;-Oz&quot; ]
</code></pre>
<p>You can find more information about optimizing Wasm bundle sizes <a href="https://rustwasm.github.io/book/reference/code-size.html#optimizing-builds-for-code-size">here</a>.</p>
</div></main></div></div></div></div><footer data-hk="1.29" class="w-full flex justify-center py-5 bg-gray-100 dark:bg-navy-deep"><p data-hk="1.30" class="dark:text-white mx-5 text-center"><span data-hk="1.31">© <a href="https://github.com/arctic-hen7" class="underline">arctic-hen7</a> ⁨2021⁩, see license <a href="https://github.com/arctic-hen7/perseus/blob/main/LICENSE" class="underline">here</a>.</span></p></footer><script data-hk="0.0" src=".perseus/static/prism.js" defer=""></script><script data-hk="0.1">window.Prism.highlightAll();</script></div></div></div></body></html>