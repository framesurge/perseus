{"state":"{\"title\":\"Optimizing Code Size\",\"content\":\"<h1>Optimizing Code Size</h1>\\n<p>If you're used to working with Rust, you're probably used to two things: performance is everything, and Rust produces big binaries. With Wasm, these actually become problems because of the way the web works. If you think about it, your Wasm files (big because Rust optimizes for speed instead of size by default) need to be sent to browsers. So, the larger they are, the slower your site will be (because it'll take longer to load). Fortunately, Perseus only makes this relevant when a user first navigates to your site with its <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/subsequent-loads\\\">subsequent loads</a> system. However, it's still worth optimizing code size in places.</p>\\n<p>Before we go any further though, it's worth addressing a common misconception about Wasm. The size of the final Wasm binary for the Perseus basic example is usually around 200-300kB (this of course changes over time), which would be utterly unacceptable with JavaScript, but this would be considered about normal for an image. It's common to compare Wasm file sizes to JS file sizes, but Wasm is actually much similar to an image, because, unlike with JS, the browser can instantiate it much more quickly because it's already been compiled. This is a complex topic, but the general idea is that Wasm file sizes are better compared to image file sizes than to JS file sizes. You can read more about this <a href=\\\"https://hacks.mozilla.org/2018/01/making-webassembly-even-faster-firefoxs-new-streaming-and-tiering-compiler/\\\">here</a>.</p>\\n<p>Now onto the optimizations. If you've worked with Rust and Wasm before, you may be familiar with <code>wasm-opt</code>, which performs a ton of optimizations for you. Perseus does this automatically with <code>wasm-pack</code>. But we can do better.</p>\\n<p>The easiest way to apply size optimizations for Perseus is the <a href=\\\"https://github.com/arctic-hen7/perseus-size-opt\\\"><code>perseus-size-opt</code> plugin</a>, which prevents the need for ejecting to apply optimizations in <code>.perseus/</code>, and requires only a single line of code to use. Check it out <a href=\\\"https://github.com/arctic-hen7/perseus-size-opt\\\">here</a> for more details! It's recommended that all Perseus apps use this plugin before they deploy to production, because it can result in size decreases of upwards of 100kb, which translates into real increases in loading time for your users.</p>\\n<p><em>Note: every size optimization has a trade-off with either speed or compile-time, and you should test the performance of your app after applying these optimizations to make sure you're happy with the results, because the balance between speed and size will be different for every app. That said, using even all these optimizations usually has a negligible performance impact.</em></p>\\n<p>Usually, this will be enough for most apps, though, if you really want to cut down a few kilobytes, you can use <code>default-features = false</code> on the <code>perseus</code> dependency in your <code>Cargo.toml</code> to deactivate <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/live-reloading\\\">live reloading</a> and <a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/hsr\\\">HSR</a>. These don't <em>do</em> anything in production, though they do have a very slight code footprint, which can be eliminated by entirely disabling their features (<code>live-reloading</code> and <code>hsr</code>, which are enabled by default). Note that you'll probably only want to do this in production, as using this setting will disable these features in development as well. Note though that this will usually only remove fewer than 5kB from your final bundle (sometimes less).</p>\\n\",\"sidebar_content\":\"<h1>Introduction</h1>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/intro\\\">Introduction</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/what-is-perseus\\\">What is Perseus?</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/core-principles\\\">Core Principles</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/tutorials/hello-world\\\">Hello World!</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/tutorials/second-app\\\">Your Second App</a></li>\\n</ul>\\n<hr />\\n<h1>Reference</h1>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/perseus-app\\\"><code>PerseusApp</code></a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/define-app\\\"><code>define_app!</code></a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/views\\\">Writing Views</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/index-view\\\">The Index View</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/debugging\\\">Debugging</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/live-reloading\\\">Live Reloading</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/intro\\\">Templates and Routing</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/metadata-modification\\\">Modifying the <code>&lt;head&gt;</code></a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/setting-headers\\\">Modifying HTTP Headers</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/templates/router-state\\\">Listening to the Router</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/error-pages\\\">Error Pages</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/static-content\\\">Static Content</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/intro\\\">Internationalization</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/defining\\\">Defining Translations</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/using\\\">Using Translations</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/translations-managers\\\">Translations Managers</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/i18n/other-engines\\\">Other Translation Engines</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/intro\\\">Rendering Strategies</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/build-state\\\">Build State</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/build-paths\\\">Build Paths</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/request-state\\\">Request State</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/revalidation\\\">Revalidation</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/incremental\\\">Incremental Generation</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/strategies/amalgamation\\\">State Amalgamation</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/hydration\\\">Hydration</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/rx\\\">Reactive State</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/global\\\">Global State</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/freezing\\\">State Freezing</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/idb-freezing\\\">Freezing to IndexedDB</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/state/hsr\\\">Hot State Reloading (HSR)</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/cli\\\">CLI</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/ejecting\\\">Ejecting</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/snooping\\\">Snooping</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/intro\\\">Testing</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/checkpoints\\\">Checkpoints</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/fantoccini-basics\\\">Fantoccini Basics</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/testing/manual\\\">Manual Testing</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/styling\\\">Styling</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/server-communication\\\">Communicating with a Server</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/stores\\\">Stores</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/exporting\\\">Static Exporting</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/intro\\\">Plugins</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/functional\\\">Functional Actions</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/control\\\">Control Actions</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/using\\\">Using Plugins</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/tinker\\\">The <code>tinker</code> Action</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/writing\\\">Writing Plugins</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/security\\\">Security Considerations</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/plugins/publishing\\\">Publishing Plugins</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/engines\\\">Engines</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/intro\\\">Deploying</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/serverful\\\">Server Deployment</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/serverless\\\">Serverless Deployment</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/size\\\">Optimizing Code Size</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/relative-paths\\\">Relative Paths</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/deploying/docker\\\">Docker Deployment</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/updating\\\">Migrating from v0.3.3</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/reference/pitfalls-and-bugs\\\">Common Pitfalls and Known Bugs</a></li>\\n</ul>\\n<hr />\\n<h1>Advanced</h1>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/intro\\\">Under the Hood</a>\\n<ul>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/arch\\\">Architecture</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/initial-loads\\\">Initial Loads</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/subsequent-loads\\\">Subsequent Loads</a></li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/routing\\\">Routing</a></li>\\n</ul>\\n</li>\\n<li><a href=\\\"https://framesurge.sh/perseus/en-US/docs/0.3.4/advanced/route-announcer\\\">Route Announcer</a></li>\\n</ul>\\n<hr />\\n<h1>Further Tutorials</h1>\\n<ul>\\n<li><a href=\\\"docs/tutorials/auth\\\">Authentication</a></li>\\n</ul>\\n\",\"status\":\"Stable\",\"manifest\":{\"0.1.x\":{\"state\":\"outdated\",\"git\":\"v0.1.4\",\"docs_rs\":\"0.1\"},\"0.2.x\":{\"state\":\"outdated\",\"git\":\"v0.2.3\",\"docs_rs\":\"0.2\"},\"0.3.0-0.3.3\":{\"state\":\"outdated\",\"git\":\"v0.3.3\",\"docs_rs\":\"0.3.3\"},\"0.4.x\":{\"state\":\"beta\",\"git\":\"HEAD\",\"docs_rs\":\"0.4.0-beta\"},\"0.3.4\":{\"state\":\"stable\",\"git\":\"v0.3.6\",\"docs_rs\":\"0.3\"}},\"current_version\":\"0.3.4\"}","head":"<title>Optimizing Code Size | Perseus Docs</title><link rel=\"stylesheet\" href=\".perseus/static/styles/markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/styles/docs_links_markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/prism.css\"/>"}