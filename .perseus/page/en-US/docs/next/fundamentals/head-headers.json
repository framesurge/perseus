{"state":{"content":"<h1>Heads and headers</h1>\n<p>So far, there are two critical parts of a webpage that we've largely ignored: the document <code>&lt;head&gt;</code>, and the HTTP headers. The former is used to store static page metadata, such as the page title, while the latter can be used for all sorts of things, such as to control resource caching and manage cookies.</p>\n<p>Generally, in Perseus, you'll use the head much more than you'll use headers, simply because Perseus generally encourages an environment that is fairly siloed from the features of browsers themselves: for example, rather than setting a cookie through the <code>Set-Cookie</code> HTTP header, it's far more common in Perseus to just provide the value of the cookie through the state that's sent to the client, and then to set it there. What you choose to do is a matter of personal preference, but Perseus is generally built around state, not things like headers.</p>\n<p><em>Note: for reading headers from the client to inform your state generation logic, see <a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/request\">request-time state generation</a>.</em></p>\n<h2>Setting the head</h2>\n<p>Heads work very much like views in Perseus: they're set on a template-by-template basis, and can take the state of the page, allowing them to specialize as necessary for pages within the templates on which they're set. </p>\n<p>Here's an example of setting the head without using any state:</p>\n<pre><code>use perseus::prelude::*;\nuse sycamore::prelude::*;\n\nfn about_page&lt;G: Html&gt;(cx: Scope) -&gt; View&lt;G&gt; {\n    view! { cx,\n        p { &quot;About.&quot; }\n    }\n}\n\n#[engine_only_fn]\nfn head(cx: Scope) -&gt; View&lt;SsrNode&gt; {\n    view! { cx,\n        title { &quot;About Page | Perseus Example â€“ Basic&quot; }\n    }\n}\n\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\n    Template::build(&quot;about&quot;).view(about_page).head(head).build()\n}\n\n</code></pre>\n<p>Note the use of <code>#[engine_only_fn]</code>, since Perseus will prerender the head of each page on the engine-side, as early as it can, and that will be transmitted as a static string to the client for further rendering. While this does mean you could theoretically do something like read from a file in your head function, this is not recommended, since the function is not <code>async</code>, and will block the rest of the build process or server, so you should prefer to do that sort of thing when generating state.</p>\n<p>Note also the use of <code>SsrNode</code> in the return type, which reflects that this will <em>always</em> be prerendered to a string on the engine-side.</p>\n<p>To access the state in the head, use <code>.head_with_state()</code> on <code>Template</code> instead of <code>.head()</code>, and have your function accept a second argument for your (unreactive) state type.</p>\n<p>If you want to return an error from your head function for some reason, you can, and that will lead to the entire page failing. Generally, this is not desired. This behaves similarly to the state generation functions, which you can read more about <a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/build\">here</a>.</p>\n<p>For information about setting a general <em>index view</em>, see <a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/perseus-app\">here</a>.</p>\n<h2>Setting headers</h2>\n<p>When you need to set headers, you can do so with a function of the same form as the one you use to set page heads: it should be synchronous and take two arguments if you're accessing your state, or one if you're not.</p>\n<p>Here's a more fully-fledged example that sets the custom <code>X-Greeting</code> header with the contents of some generated state:</p>\n<pre><code>use perseus::prelude::*;\nuse serde::{Deserialize, Serialize};\nuse sycamore::prelude::*;\n\n#[derive(Serialize, Deserialize, Clone, ReactiveState)]\n#[rx(alias = &quot;PageStateRx&quot;)]\nstruct PageState {\n    greeting: String,\n}\n\nfn index_page&lt;'a, G: Html&gt;(cx: BoundedScope&lt;'_, 'a&gt;, state: &amp;'a PageStateRx) -&gt; View&lt;G&gt; {\n    view! { cx,\n        p { (state.greeting.get()) }\n    }\n}\n\n#[engine_only_fn]\nfn head(cx: Scope) -&gt; View&lt;SsrNode&gt; {\n    view! { cx,\n        title { &quot;Index Page&quot; }\n    }\n}\n\npub fn get_template&lt;G: Html&gt;() -&gt; Template&lt;G&gt; {\n    Template::build(&quot;index&quot;)\n        .view_with_state(index_page)\n        .head(head)\n        .build_state_fn(get_build_state)\n        // There is also `.set_headers()`, which takes a function that does not use the page state\n        .set_headers_with_state(set_headers)\n        .build()\n}\n\n#[engine_only_fn]\nasync fn get_build_state(_info: StateGeneratorInfo&lt;()&gt;) -&gt; PageState {\n    PageState {\n        greeting: &quot;Hello World!&quot;.to_string(),\n    }\n}\n\n// Unfortunately, this return type does have\n// to be fully qualified, or you have to import it with a server-only\n// target-gate.\n//\n// This function takes a a scope so it can get at a `Reactor`, which will have\n// the global state and, potentially, a translator. This can allow you to create\n// localized headers.\n#[engine_only_fn]\nfn set_headers(_cx: Scope, state: PageState) -&gt; perseus::http::header::HeaderMap {\n    // These imports are only available on the server-side, which this function is\n    // automatically gated to\n    use perseus::http::header::{HeaderMap, HeaderName};\n\n    let mut map = HeaderMap::new();\n    map.insert(\n        HeaderName::from_lowercase(b&quot;x-greeting&quot;).unwrap(),\n        state.greeting.parse().unwrap(),\n    );\n    map\n}\n\n</code></pre>\n<p>Note the use of <code>.set_headers_with_state()</code> on <code>Template</code>, but this could also be <code>.set_headers()</code> if you didn't need access to your state type.</p>\n<p>What is by far most important about this function is its return type, which comes from the <a href=\"https://docs.rs/http/latest/http\"><code>http</code></a> crate, conveniently re-exported from Perseus on the engine-side. You'll need a return a <a href=\"https://docs.rs/perseus/0.4.0-beta/perseus/http/header/struct.HeaderMap.html\"><code>HeaderMap</code></a>, specifically, into which you can insert individiual headers, similarly to a <code>HashMap</code>.</p>\n<p>Just like the head function, this can also return an error if you'd like it to, or it can be infallible, as it is here.</p>\n","current_version":"next","manifest":{"0.1.x":{"docs_rs":"0.1","git":"v0.1.4","state":"outdated"},"0.2.x":{"docs_rs":"0.2","git":"v0.2.3","state":"outdated"},"0.3.0-0.3.3":{"docs_rs":"0.3.3","git":"v0.3.3","state":"outdated"},"0.3.4":{"docs_rs":"0.3","git":"v0.3.6","state":"stable"},"0.4.x":{"docs_rs":"0.4.0-beta","git":"HEAD","state":"beta"}},"sidebar_content":"<h1>Introduction</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/quickstart\">Quickstart</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/what-is-perseus\">What is Perseus?</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/core-principles\">Core Principles</a></li>\n</ul>\n<h1>Your First App</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/installation\">Installing Perseus</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/defining\">Defining your app</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/generating-pages\">Generating pages</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/dev-cycle\">Development cycle</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/error-handling\">Error handling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/first-app/deploying\">Deploying your app</a></li>\n</ul>\n<h1>Fundamentals</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/perseus-app\"><code>PerseusApp</code></a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/reactor\">The reactor</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/routing\">Routing and navigation</a>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/preloading\">Preloading</a></li>\n</ul>\n</li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/i18n\">Internationalization</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/error-views\">Error views</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/hydration\">Hydration</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/static-content\">Static content</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/head-headers\">Heads and headers</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/styling\">Styling</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/js-interop\">Working with JS</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/serving-exporting\">Servers and exporting</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/debugging\">Debugging</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/testing\">Writing tests</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/plugins\">Plugins</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/fundamentals/compilation-times\">Improving Compilation Times</a></li>\n</ul>\n<h1>The State Platform</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/intro\">Understanding state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/build\">Build-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/request\">Request-time state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/revalidation\">Revalidation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/incremental\">Incremental generation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/amalgamation\">State amalgamation</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/browser\">Using state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/global\">Global state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/helper\">Helper state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/suspense\">Suspended state</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/state/freezing-thawing\">Freezing and thawing</a></li>\n</ul>\n<h1>Capsules</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/intro\">Introduction</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/capsules-vs-templates\">Capsules vs. templates</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/capsules/delayed\">Delayed widgets</a></li>\n</ul>\n<h1>Miscellaneous</h1>\n<ul>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/migrating\">Migrating from v0.3.x</a></li>\n<li><a href=\"https://framesurge.sh/perseus/en-US/docs/next/faq\">Common pitfalls and FAQs</a></li>\n</ul>\n","status":"Next","title":"Heads and headers"},"head":"<title>Heads and headers | Perseus Docs</title><link rel=\"stylesheet\" href=\".perseus/static/styles/markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/styles/docs_links_markdown.css\"/><link rel=\"stylesheet\" href=\".perseus/static/prism.css\"/>"}